<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¸€æ¯å’–å•¡çš„æ—¶é—´</title>
  
  <subtitle>è‹¦ä¸­ä½œä¹</subtitle>
  <link href="http://blog.jobshen.com/atom.xml" rel="self"/>
  
  <link href="http://blog.jobshen.com/"/>
  <updated>2020-12-23T13:30:03.000Z</updated>
  <id>http://blog.jobshen.com/</id>
  
  <author>
    <name>Job Shen</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2020å¹´å›é¡¾</title>
    <link href="http://blog.jobshen.com/posts/8999c837.html"/>
    <id>http://blog.jobshen.com/posts/8999c837.html</id>
    <published>2020-12-23T13:30:03.000Z</published>
    <updated>2020-12-23T13:30:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;2020å¹´å¯¹äºæˆ‘æ¥è¯´ï¼ŒçœŸçš„å¯ä»¥è¯´æ˜¯å¤šç¾å¤šéš¾çš„ä¸€å¹´ï¼Œå„ç§â€œå¯æ€•â€çš„äº‹æƒ…æ¥è¸µè€Œè‡³ï¼Œå·®ç‚¹å°±æŠŠæˆ‘ç»™æ‰“è¶´ä¸‹ï¼Œè¿˜å¥½ç°åœ¨2020ç»ˆäºå¿«è¿‡å®Œäº†ï¼Œè€Œæˆ‘çš„ç”Ÿæ´»ä¹Ÿç»ˆäºæ¸æ¸æ­¥å…¥æ­£è½¨äº†ï¼Œåœ¨è¿™é‡ŒçŸ¥è¯†æƒ³å¯¹è¿™ä¸€å¹´ä¸­å‘ç”Ÿçš„ä¸€äº›äº‹æƒ…åšä¸€ä¸‹è®°å½•ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä»¥åçš„æ—¥å­é‡Œå¼•ä»¥ä¸ºæˆ’ï¼ŒåŒæ—¶ä¹Ÿå¯¹2021å¹´ç«‹å‡ ä¸ª<strong>flag</strong>ã€‚</p><a id="more"></a><h2 id="ç–«æƒ…"><a href="#ç–«æƒ…" class="headerlink" title="ç–«æƒ…"></a>ç–«æƒ…</h2><p>&emsp;&emsp;å¹´åˆçš„ç–«æƒ…æŠŠå¤§ä¼™éƒ½æå¾—å¿ƒåŠ›äº¤ç˜ï¼Œäººå¿ƒæƒ¶æƒ¶ã€‚æˆ‘ä¹Ÿä¸€æ ·ï¼Œä»è…ŠæœˆäºŒåå‡ å¼€å§‹å°±ä¸€ç›´æ˜¯å¤§é—¨ä¸è¿ˆäºŒé—¨ä¸å‡ºï¼Œæ­»å®…å®¶é‡Œã€‚åé¢ç¨ç¨å¥½è½¬ä¸€ç‚¹äº†ï¼Œæƒ³å‡ºä¸ªé—¨å°±ä¼šè¿æ¥è€å©†çš„å¦‚åŒæ­»ç¥èˆ¬çš„æ­»çªï¼Œä¸€ç›´åˆ°äº†5æœˆä»½æ‰æ•¢æ­£å¸¸ç‚¹çš„å‡ºé—¨ã€‚è¯´èµ·æ¥åœ¨å®¶é‡Œä¸€å®…å°±æ˜¯å°åŠå¹´å•ŠğŸ˜‚ å½“ç„¶ä¸ºå•¥çœŸçš„ä¼šå®…è¿™ä¹ˆä¹…ä¹Ÿä¸å…‰æ˜¯ç–«æƒ…å®³çš„ã€‚</p><h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><p>&emsp;&emsp;è™½ç„¶æœ‰æƒ³åˆ°ç”±äºç–«æƒ…å·¥ä½œä¼šä¾¿åœ°è‰°éš¾ç‚¹ï¼Œå¯æ˜¯ä¸‡ä¸‡æ²¡æƒ³åˆ°ä¼šæ¥çš„è¿™ä¹ˆå¿«ã€‚åˆšæ¢å¤è¿œç¨‹å·¥ä½œæ²¡å‡ å¤©ï¼Œå°±æ¥åˆ°äº†HRæ‰“æ¥çš„åŠé€€è§†å±ä¼šè®®â€“ä¼ä¸šæƒ³è£å‘˜ä½†åˆä¸æƒ³ç»™èµ”å¿ï¼Œå°±æƒ³ç€ç»™å‘˜å·¥æ´—è„‘è®©å…¶ä¸»åŠ¨ç¦»èŒã€‚ç”±äºå»å¹´ä¸‹åŠå¹´å¼€å§‹å°±å’Œç›´å±é¢†å¯¼æœ‰ç‚¹å°æ‘©æ“¦è¢«ä¸æ–­åœ°ç©¿å°é‹ï¼Œæ‰€ä»¥è‡ªç„¶è€Œç„¶åœ°æˆ‘æ˜¯é‚£ä¸ªé¦–å½“å…¶å†²åœ°éœ€è¦è¢«â€œè£â€çš„äººã€‚å¯æ˜¯å†æ€ä¹ˆè¯´ä¹Ÿä¸èƒ½å¹³ç™½æ— æ•…åœ°è¢«æ¬ºè´Ÿæ˜¯å§ï¼Œç»è¿‡äº†ä¸€ä¸ªå¤šæ˜ŸæœŸçš„æ²Ÿé€šç»ˆäºè¿˜æ˜¯æ‹¿åˆ°äº†åº”å¾—çš„è¡¥å¿ï¼Œä¸­é—´çš„è¿‡ç¨‹å¯è°“â€œå¹ä¸ºè§‚æ­¢â€ã€â€œå¥‡äº‹é¢‘å‡ºâ€ã€‚å½“ç„¶æ¼”æŠ€æœ€å¥½çš„è¿˜å±HRã€‚å¯è°“æ˜¯è½¯ç¡¬å…¼æ–½ï¼Œåå…«èˆ¬æ­¦è‰ºé½ä¸Šé˜µã€‚å…ˆæ˜¯åœ¨é‚£è‡ªè´£å·¥ä½œå¤±è¯¯å•Šï¼Œæ²¡æœ‰å®ŒæˆæŒ‡æ ‡å•Šï¼Œå¯æ€œå¯æ€œæˆ‘å•Šï¼›å†è€…å°±æ˜¯æå“ï¼Œä»€ä¹ˆä½ ä¸ç¦»èŒåˆ°æ—¶å€™èƒŒè°ƒä½ å°±ç­‰ç€å§ï¼Œç¦»èŒè¯æ˜çš„ææ–™ä½ ä¹Ÿç­‰ç€å§ï¼Œçœ‹ä½ æ€ä¹ˆæ‰¾å·¥ä½œã€‚å†ç»†çš„å°±ä¸æƒ³å¤šè¯´äº†ã€‚</p><h2 id="æ‰¾å·¥ä½œ"><a href="#æ‰¾å·¥ä½œ" class="headerlink" title="æ‰¾å·¥ä½œ"></a>æ‰¾å·¥ä½œ</h2><p>&emsp;&emsp;ç”±äºç–«æƒ…å½±å“ï¼Œè¿™æ®µæ—¶å€™æ‰¾å·¥ä½œæ˜¯çœŸçš„æœ‰ç‚¹å›°éš¾ï¼Œå‰å‰ååå¤§æ¦‚é¢è¯•äº†åä¸ƒå…«å®¶ä¼ä¸šï¼Œå…¶ä¸­4å®¶å·¦å³æ˜¯æ²¡æœ‰é¢ä¸Šã€3å®¶èŒä½ä¸åˆé€‚æ²¡æœ‰æ¥offerã€3å®¶æ˜¯ä»¥å¥‡è‘©ç†ç”±ç»™æ‹’çš„ï¼ˆæ¯”å¦‚ä½ ä½çš„å¤ªè¿œç­‰ç­‰ï¼‰ï¼Œå‰©ä¸‹çš„æ˜¯ç”±äºèƒŒè°ƒï¼Œè¿™æ—¶å€™æ‰çŸ¥é“å•Šï¼Œæ¯•ç«Ÿæ­å·çš„ç§‘æŠ€å…¬å¸HRçš„åœˆå­å¾ˆå°çš„ã€‚å¥½åœ¨æœ€åè¿˜æ˜¯æ‰¾åˆ°äº†ä¸€å®¶æ»¡æ„çš„å…¬å¸ï¼Œå¯ä»¥ç»§ç»­å¼€å¼€å¿ƒå¿ƒç ä»£ç äº†ã€‚</p><h2 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h2><p>é©¬ä¸Šå°±è¦è¿›å…¥2021å¹´äº†ï¼ŒæœŸæœ›æ–°çš„ä¸€å¹´æ²¡æœ‰å¦‚æ­¤ä¹‹å¤šåœ°ç£•ç£•ç»Šç»Šï¼Œåœ¨æ­¤ä¹Ÿæ˜¯ç«‹ä¸‹å‡ ä¸ªflagï¼Œä¹Ÿç®—æ˜¯ç»™è‡ªå·±å®šä¸ªå°ç›®æ ‡å§ã€‚</p><ul><li>æä¸€ä¸ªopensource project ï¼ˆå·²ç»å’Œå°ä¼™ä¼´å†è§„åˆ’äº† æœŸæœ›æ–°çš„ä¸€å¹´çœŸçš„èƒ½æœ‰å§‹æœ‰ç»ˆåœ°å»æä¸‹å»ï¼‰</li><li>æŠŠå·¥ä½œä¸­çš„ç»éªŒåˆ†äº«å‡ºæ¥ï¼Œä¹Ÿç®—æ˜¯å¯¹å…¶çš„ä¸€ä¸ªæ€»ç»“å§ï¼ˆç›®å‰æ‰‹å¤´çš„å‡ ä¸ªé¡¹ç›®éƒ½è›®æœ‰æ„æ€çš„ï¼‰</li><li>rustï¼ˆä¸€ç›´æƒ³å­¦ä¹ ä¸‹å‘¢ï¼‰</li><li>å®Œæˆä¸€ä»¶äººç”Ÿå¤§äº‹</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&amp;emsp;&amp;emsp;2020å¹´å¯¹äºæˆ‘æ¥è¯´ï¼ŒçœŸçš„å¯ä»¥è¯´æ˜¯å¤šç¾å¤šéš¾çš„ä¸€å¹´ï¼Œå„ç§â€œå¯æ€•â€çš„äº‹æƒ…æ¥è¸µè€Œè‡³ï¼Œå·®ç‚¹å°±æŠŠæˆ‘ç»™æ‰“è¶´ä¸‹ï¼Œè¿˜å¥½ç°åœ¨2020ç»ˆäºå¿«è¿‡å®Œäº†ï¼Œè€Œæˆ‘çš„ç”Ÿæ´»ä¹Ÿç»ˆäºæ¸æ¸æ­¥å…¥æ­£è½¨äº†ï¼Œåœ¨è¿™é‡ŒçŸ¥è¯†æƒ³å¯¹è¿™ä¸€å¹´ä¸­å‘ç”Ÿçš„ä¸€äº›äº‹æƒ…åšä¸€ä¸‹è®°å½•ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä»¥åçš„æ—¥å­é‡Œå¼•ä»¥ä¸ºæˆ’ï¼ŒåŒæ—¶ä¹Ÿå¯¹2021å¹´ç«‹å‡ ä¸ª&lt;strong&gt;flag&lt;/strong&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æ€»ç»“" scheme="http://blog.jobshen.com/categories/%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="æ„Ÿæ‚Ÿ" scheme="http://blog.jobshen.com/tags/%E6%84%9F%E6%82%9F/"/>
    
    <category term="éšç¬”" scheme="http://blog.jobshen.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="æ€»ç»“" scheme="http://blog.jobshen.com/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºJavaæ—¥å¿—éš”ç¦»åŠŸèƒ½çš„é—²è°ˆ</title>
    <link href="http://blog.jobshen.com/posts/be21c8ca.html"/>
    <id>http://blog.jobshen.com/posts/be21c8ca.html</id>
    <published>2019-01-21T14:20:16.000Z</published>
    <updated>2019-01-21T14:20:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>&emsp;&emsp;æˆ‘ä»¬éƒ½çŸ¥é“æ—¥å¿—è‡³äºä»»ä½•ç³»ç»Ÿã€è½¯ä»¶éƒ½æ˜¯ååˆ†é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œé€šè¿‡æ—¥å¿—æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°äº†è§£åˆ°ç°åœ¨ç³»ç»Ÿè¿è¡Œæ˜¯å¦æ­£å¸¸ã€æ˜¯å¦æœ‰å¼‚å¸¸æƒ…å†µã€‚ä½†æœ‰æ—¶å€™æ—¥å¿—å¤ªå¤šäº†ä¹Ÿä¼šæœ‰å¹¸ç¦åœ°çƒ¦æ¼ï¼Œå‘ç”Ÿå¼‚å¸¸æƒ³é€šè¿‡æ—¥å¿—è¿›è¡Œæ’æŸ¥ï¼Œå¯æ˜¯æ»¡å±åœ°æ—¥å¿—éƒ½æ˜¯ä¸é‚£ä¹ˆé‡è¦åœ°å†…å®¹ï¼Œåƒå¿ƒè·³æ—¥å¿—ã€debugæ—¥å¿—ç­‰ç­‰ã€‚</p><p>&emsp;&emsp;è¿™åœ¨javaåº”ç”¨å°¤ä¸ºä¸¥é‡ï¼Œä½ æ¯å¼•å…¥åœ°ä¸€ä¸ªjaréƒ½æœ‰å¯èƒ½å¼•å…¥ä¸€å †æ‰“å°çš„æ—¥å¿—ï¼Œè¿™æ ·ä¸€æ¥è¦ä»æ—¥å¿—ä¸­æ‰¾åˆ°ä½ æ‰€éœ€è¦çš„å†…å®¹å°†æ˜¯ä¸€ä»¶æå…¶å›°éš¾çš„äº‹æƒ…ã€‚å½“ç„¶ï¼Œä½ ä¼šè¯´ï¼Œjavaæ‹¥æœ‰è¿™ä¹ˆå¤šä¼˜ç§€çš„æ—¥å¿—æ¡†æ¶ç³»ç»Ÿï¼Œå¯ä»¥ç®€å•åœ°é€šè¿‡ç›¸åº”åœ°é…ç½®æ–‡ä»¶å°†è¿™äº›å†…å®¹æ ¹æ®ä¸åŒçš„è¾“å‡ºçº§åˆ«è¾“å‡ºåˆ°ä¸åŒçš„ç›®å½•æ–‡ä»¶ï¼Œå¯æ˜¯å¦‚æœå°†è¿™ä»¶äº‹æƒ…éƒ½äº¤ç»™ç»ˆç«¯ç”¨æˆ·å»å¤„ç†ï¼Œé‚£å°†ä¼šæ˜¯ä¸€ä»¶æå…¶å¤æ‚çš„å·¥ç¨‹ï¼Œä»–å¾—æ˜ç™½å“ªäº›æ˜¯ä»–éœ€è¦çš„ã€å“ªäº›æ˜¯ä»–ä¸éœ€è¦çš„ï¼Œè€Œè¿™äº›ä¿¡æ¯åº”è¯¥æ˜¯å¯¹åº”çš„å¼€å‘äººå‘˜æœ€æ¸…æ¥šä¸è¿‡çš„ï¼Œå› æ­¤è®©å¼€å‘äººå‘˜æå‰å°†è¿™äº›æ—¥å¿—è¿›è¡Œå½’ç±»ï¼Œè¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œé‚£å¯¹åº”ä½¿ç”¨è€…æ¥è¯´å°†ä¼šå˜å¾—å¾ˆç®€å•ã€‚</p><a id="more"></a><h2 id="å®ç°æ–¹æ³•ä¸€"><a href="#å®ç°æ–¹æ³•ä¸€" class="headerlink" title="å®ç°æ–¹æ³•ä¸€"></a>å®ç°æ–¹æ³•ä¸€</h2><p>&emsp;&emsp;é¦–å…ˆæƒ³åˆ°çš„åº”è¯¥å°±æ˜¯é€šè¿‡æ—¥å¿—çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¸åŒçš„<code>appender</code>å’Œ<code>logger</code>ã€‚å¯æ˜¯è¿™äº›é…ç½®æ–‡ä»¶åº”è¯¥æ˜¯å­˜åœ¨ä¸ç”¨æˆ·çš„åº”ç”¨ä¸­çš„ï¼Œä½œä¸ºä¸€ä¸ªè¢«å¼•å…¥çš„moduleè¯¥å¦‚ä½•å»ä¿®æ”¹è¿™ä»½æ–‡ä»¶å‘¢ï¼Ÿè€Œä¸”ç”¨æˆ·æœ€ç»ˆé‡‡ç”¨çš„æ˜¯å“ªä¸ªæ—¥å¿—æ¡†æ¶æˆ‘åŒæ ·ä¸èƒ½å·¦å³ï¼Œæˆ‘è¯¥æ ¹æ®å“ªä¸ªå®ç°å‘¢ï¼Ÿ</p><p>&emsp;&emsp;ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¾ˆå¥½è§£å†³ï¼Œç°åœ¨å¤§éƒ¨åˆ†çš„æ—¥å¿—æ¡†æ¶éƒ½æä¾›äº†åŸºäºjava ä»£ç çš„æ–¹å¼æ¥æ·»åŠ <code>appender</code>å’Œ<code>logger</code>çš„é…ç½®ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼Œè·å–<code>LoggerContext</code>å¯¹è±¡ï¼Œç„¶åæ·»åŠ è‡ªå®šä¹‰çš„<code>appender</code>å’Œ<code>logger</code>å³å¯ï¼Œä¾‹å¦‚é˜¿é‡Œçš„TDDLä¸­å°±æœ‰ç›¸å…³çš„å®ç°ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// slf4jåªæ˜¯ä¸€ä¸ªä»£ç†å·¥ç¨‹ï¼Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹å…·ä½“çš„å®ç°ç±»</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkLogger</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span> LOGBACK<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>canUseEncoder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        dynamic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicLogbackLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        dynamic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicLogback918Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkLogger</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span> <span class="token class-name">LOG4J_Adapter</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    dynamic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicLog4jAdapterLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkLogger</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span> LOG4J<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    dynamic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicLog4jLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"logger is not a log4j/logback instance, dynamic logger is disabled"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆåˆ¤æ–­å…·ä½“åœ°å®ç°æ¡†æ¶æ˜¯å“ªä¸ªï¼Œç„¶åå†è·å¾—å¯¹åº”å®ç°æ¡†æ¶çš„<code>loggerContext</code>ï¼Œä¾‹å¦‚<code>logback</code>ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>loggerContext <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">ILoggerFactory</span> lcObject <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getILoggerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>lcObject <span class="token keyword">instanceof</span> <span class="token class-name">LoggerContext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LogbackException</span><span class="token punctuation">(</span><span class="token string">"Expected LOGBACK binding with SLF4J, but another log system has taken the place: "</span> <span class="token operator">+</span> lcObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    loggerContext <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoggerContext</span><span class="token punctuation">)</span> lcObject<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> entry <span class="token operator">:</span> props<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            loggerContext<span class="token punctuation">.</span><span class="token function">putProperty</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ç€å†æ·»åŠ è‡ªèº«æ‰€éœ€çš„<code>appender</code>å’Œ<code>logger</code>ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Appender</span> <span class="token function">buildAppender</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">String</span> pattern<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">RollingFileAppender</span> appender <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RollingFileAppender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>appender<span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>loggerContext<span class="token punctuation">)</span><span class="token punctuation">;</span>appender<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>appender<span class="token punctuation">.</span><span class="token function">setAppend</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>appender<span class="token punctuation">.</span><span class="token function">setFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token function">getLogPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">TimeBasedRollingPolicy</span> rolling <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimeBasedRollingPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>rolling<span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>loggerContext<span class="token punctuation">)</span><span class="token punctuation">;</span>rolling<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span>appender<span class="token punctuation">)</span><span class="token punctuation">;</span>rolling<span class="token punctuation">.</span><span class="token function">setFileNamePattern</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token function">getLogPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".%d&#123;yyyy-MM-dd&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>rolling<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>appender<span class="token punctuation">.</span><span class="token function">setRollingPolicy</span><span class="token punctuation">(</span>rolling<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">PatternLayoutEncoder</span> layout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PatternLayoutEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>layout<span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>loggerContext<span class="token punctuation">)</span><span class="token punctuation">;</span>layout<span class="token punctuation">.</span><span class="token function">setPattern</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">;</span>layout<span class="token punctuation">.</span><span class="token function">setCharset</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>layout<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>appender<span class="token punctuation">.</span><span class="token function">setEncoder</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¯åŠ¨</span>appender<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> appender<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯æ˜¯è¿™æ ·åšï¼Œå­˜åœ¨çš„é—®é¢˜ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼š</p><ul><li>éœ€è‡ªå·±åˆ¤æ–­åº”ç”¨é‡‡ç”¨çš„å®ç°æ¡†æ¶ï¼Œä½†å¯ä»¥é€šè¿‡æŠ½å–çš„æ–¹å¼æ„å»ºä¸€ä¸ªå…¬å…±jarï¼Œä¾‹å¦‚commonåŒ…</li><li>è¯¥å®ç°æ¡†æ¶éœ€è¦èƒ½å¤Ÿæ”¯æŒé€šè¿‡åŠ¨æ€çš„å½¢å¼æ·»åŠ <code>appender</code></li><li>ä»ç„¶ä¸åº”ç”¨çš„<code>Log</code>è€¦åˆåœ¨ä¸€èµ·</li></ul><p>é‚£é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹å¼èƒ½å¤Ÿå®ç°åŒæ ·çš„åŠŸèƒ½å—ï¼Ÿç­”æ¡ˆå½“æ—¶æ˜¯**<em>æœ‰**</em>ã€‚</p><h2 id="å®ç°æ–¹æ³•äºŒ"><a href="#å®ç°æ–¹æ³•äºŒ" class="headerlink" title="å®ç°æ–¹æ³•äºŒ"></a>å®ç°æ–¹æ³•äºŒ</h2><p>&emsp;&emsp;é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªåº”ç”¨å¯åŠ¨åï¼Œåªä¼šå­˜åœ¨ä¸€ä¸ª<code>loggerContext</code>ï¼Œå› ä¸ºæ—¥å¿—æ¡†æ¶éƒ½æ˜¯å•ä¾‹æ¨¡å¼çš„ï¼Œä¹Ÿæ˜¯ä¸ºäº†å‡å°‘å¼€é”€ã€‚é‚£å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª<code>loggerContext</code>å‘¢ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ¯ä¸ªéœ€è¦çš„<code>modeule</code>éƒ½æ‹¥æœ‰ä¸€ä»½å•ç‹¬çš„<code>loggerContext</code>ï¼Œé‚£ä¸å°±å¯ä»¥é€šè¿‡åŠ è½½é…ç½®æ–‡ä»¶çš„å½¢å¼æ›´è½»é‡çº§åœ°æ¥å®ç°éœ€è¦åŠ¨æ€æ·»åŠ <code>appender</code>çš„åŠŸèƒ½å‘¢ã€‚</p><p>å¤§è‡´çš„å®ç°é€»è¾‘åº”è¯¥æ˜¯è¿™æ ·ï¼š</p><ul><li>éœ€è¦ä¸€ä¸ª<code>map</code>æ¥ç®¡ç†æ‰€æœ‰çš„è¿™äº›<code>loggerContext</code>ï¼Œä»¥æ¯ä¸ª<code>module</code>çš„<code>groupId</code>+<code>artifactId</code>ï¼ˆç°åœ¨90%ä»¥ä¸Šçš„å·¥ç¨‹éƒ½æä¾›mavenåæ ‡ï¼‰ä¸ºå”¯ä¸€æ ‡è¯† â€“ <code>key</code></li><li>æ¯ä¸ªmoduleè‡ªèº«éœ€è¦æœ‰ä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œå½“ç„¶ç”±äºæ—¥å¿—å®ç°å¾ˆå¤šä½ å¯èƒ½éœ€è¦å¤šä»½æ–‡ä»¶ï¼ŒåŒæ ·ä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„æ ¼å¼ï¼Œç„¶åé€šè¿‡java codeçš„å½¢å¼å»è½¬åŒ–ä¸ºæœ€ç»ˆçš„å„ä¸ªä¸åŒå®ç°</li><li>éœ€è¦èƒ½é€šè¿‡å”¯ä¸€çš„Idï¼Œä¾‹å¦‚<code>groupId</code>+<code>artifactId</code>å®šä½åˆ°ä½ çš„é…ç½®æ–‡ä»¶</li></ul><p>è¿™æ ·å¤§è‡´çš„ä¸€ä¸ªå¯ä»¥åšåˆ°æ—¥å¿—éš”ç¦»çš„ç®€å•æ¡†æ¶å°±æ­å»ºèµ·æ¥äº†ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œä¸€äº›æ—¥å¿—æ¡†æ¶å¯ä»¥åŠ¨æ€åˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œè¿™å°±ä½¿å¾—ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ”¹å˜æ—¥å¿—å‚æ•°ï¼Œä¾‹å¦‚æ—¥å¿—çº§åˆ«ã€‚</p><p>è·å–ä¸€ä¸ªå•ç‹¬çš„loggerå¯¹è±¡ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ModuleLoggerManager</span><span class="token punctuation">.</span><span class="token function">getLoggerByCoordinate</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">"coordinate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»´æŠ¤<code>logger</code>ç›¸å…³å¯¹è±¡ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ModuleLogId</span><span class="token punctuation">,</span> <span class="token class-name">ModuleLogInfo</span><span class="token punctuation">></span></span> MODULE_LOGGER_MAP <span class="token operator">=</span>            <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ModuleLogId</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä¸€äº›å¯ä¿®æ”¹çš„æ—¥å¿—é…ç½®ä¿¡æ¯ï¼Œå¯é€šè¿‡$&#123;key&#125;çš„å½¢å¼ä¼ é€’</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span>              coordinate<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">ModuleLogId</span> <span class="token function">addTag</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        tags<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ModuleLogInfo</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Getter</span>    <span class="token annotation punctuation">@Setter</span>    <span class="token comment">// æ ¹æ®å…·ä½“å®ç°ä¼šåˆ›å»ºä¸åŒçš„loggerFactoryå¯¹è±¡ï¼Œç„¶åä¸åŒçš„logFactoryå¯¹è±¡ä¼šåˆ›å»ºä¸åŒçš„loggerContextå¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">AbstractLoggerModuleFactory</span> abstractLoggerModuleFactory<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Getter</span>    <span class="token keyword">private</span> <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ›å»ºfactoryè¿‡ç¨‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">AbstractLoggerModuleFactory</span> <span class="token function">createILoggerFactory</span><span class="token punctuation">(</span><span class="token class-name">ModuleLogId</span> moduleLogId<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> moduleClassLoader<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token class-name">Module_LOGGER_DISABLE_PROP_KEY</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token operator">&amp;&amp;</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span>TRUE<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token class-name">Module_LOGGER_DISABLE_PROP_KEY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>DEFAULT_LOGGER<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Module Logger is disabled!  -D&#123;&#125;=true"</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token class-name">Module_LOGGER_DISABLE_PROP_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> JVM_LOGGER_FACTORY<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// set log props</span><span class="token class-name">LogTypeJudgeUtil</span><span class="token punctuation">.</span><span class="token function">processGlobalSystemLogProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// do create</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token comment">// first log4j2</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">LogTypeJudgeUtil</span><span class="token punctuation">.</span><span class="token function">isLog4j2Usable</span><span class="token punctuation">(</span>moduleClassLoader<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">return</span> log4j2LoggerFactory<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//second logback</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">LogTypeJudgeUtil</span><span class="token punctuation">.</span><span class="token function">isLogbackUsable</span><span class="token punctuation">(</span>moduleClassLoader<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>            <span class="token keyword">return</span> logbackLoggerFactory<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// third log4j</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">LogTypeJudgeUtil</span><span class="token punctuation">.</span><span class="token function">isLog4jUsable</span><span class="token punctuation">(</span>moduleClassLoader<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>            <span class="token keyword">return</span> log4jLoggerFactory<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>DEFAULT_LOGGER<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"No log util is usable, Default app logger will be used."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>DEFAULT_LOGGER<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Build ILoggerFactory error! Default app logger will be used."</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> JVM_LOGGER_FACTORY<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥log4j2ä¸ºä¾‹ï¼Œè·å–loggerFactoryï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * confFileUrl ä¸ºæ ¹æ®ä¼ å…¥çš„coordinateä»¥åŠå…·ä½“çš„æ—¥å¿—å®ç°æ¡†æ¶ï¼Œæ‹¼æ¥å‡ºè·¯å¾„ * ä¾‹å¦‚ coordinate ä¸º org.jobshen.mq.rocketmq * åˆ™ log4j2çš„æ–‡ä»¶è·¯å¾„ä¸ºï¼šclasspath*:org/jobshen/mq/rocketmq/log/log4j2/log-conf.xml */</span><span class="token keyword">protected</span> <span class="token class-name">AbstractLoggerModuleFactory</span> <span class="token function">doBuild</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> coordinate<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ClassLoader</span> moduleClassLoader<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">URL</span> confFileUrl<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ„å»ºå•ç‹¬çš„loggerContextå¯¹è±¡</span><span class="token keyword">final</span> <span class="token class-name">LoggerContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggerContext</span><span class="token punctuation">(</span>coordinate<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> confFileUrl<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Configuration</span> config <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token class-name">ConfigurationFactory</span> configurationFactory <span class="token operator">=</span> <span class="token class-name">ConfigurationFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>parameterTypes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>parameterTypes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> URI<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>parameterTypes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span><span class="token class-name">Method</span> getConfigurationMethod <span class="token operator">=</span> configurationFactory<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getConfiguration"</span><span class="token punctuation">,</span> parameterTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>config <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">)</span> getConfigurationMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>configurationFactory<span class="token punctuation">,</span>coordinate<span class="token punctuation">,</span> confFileUrl<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> moduleClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> noSuchMethodException<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>parameterTypes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">LoggerContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>parameterTypes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>parameterTypes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> URI<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>parameterTypes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span><span class="token class-name">Method</span> getConfigurationMethod <span class="token operator">=</span> configurationFactory<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getConfiguration"</span><span class="token punctuation">,</span> parameterTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>config <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">)</span> getConfigurationMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>configurationFactory<span class="token punctuation">,</span>context<span class="token punctuation">,</span> coordinate<span class="token punctuation">,</span> confFileUrl<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> moduleClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>config <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"No log4j2 configuration are found."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span> entry <span class="token operator">:</span> <span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//from Map&lt;String,String></span>config<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span> entry <span class="token operator">:</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//from Map&lt;String,String></span>config<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>context<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AbstractLoggerModuleFactory</span><span class="token punctuation">(</span><span class="token function">getLoggingType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span><span class="token class-name">Log4jLogger</span><span class="token punctuation">></span></span> loggerMap <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">Logger</span> <span class="token function">setLevel</span><span class="token punctuation">(</span><span class="token class-name">String</span> loggerName<span class="token punctuation">,</span> <span class="token class-name">ModuleLogLevel</span> logLevel<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span><span class="token class-name">Log4jLogger</span> log4jLoggerAdapter <span class="token operator">=</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span><span class="token class-name">Log4jLogger</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>loggerName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">final</span> <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span>ROOT_LOGGER_NAME<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>loggerName<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span>ROOT_LOGGER_NAME<span class="token operator">:</span> loggerName<span class="token punctuation">;</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>core<span class="token punctuation">.</span><span class="token class-name">Logger</span> log4j2Logger <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//level</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span><span class="token class-name">Level</span> log4j2Level <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toLog4j2Level</span><span class="token punctuation">(</span>logLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>log4j2Logger<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span>log4j2Level<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> log4jLoggerAdapter<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span>            <span class="token comment">//ä½¿ç”¨é—¨é¢æ¡†æ¶ slf4j è¿”å›loggerå¯¹è±¡</span><span class="token keyword">public</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span><span class="token class-name">Logger</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">final</span> <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span>ROOT_LOGGER_NAME<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span>ROOT_LOGGER_NAME<span class="token operator">:</span> name<span class="token punctuation">;</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>core<span class="token punctuation">.</span><span class="token class-name">Logger</span> log4jLogger <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Log4jLogger</span> oldInst <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loggerMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>oldInst <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> oldInst<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Log4jLogger</span> newInst <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Log4jLogger</span><span class="token punctuation">(</span>log4jLogger<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>oldInst <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loggerMap<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> newInst<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> oldInst <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> newInst <span class="token operator">:</span> oldInst<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span><span class="token class-name">Level</span> <span class="token function">toLog4j2Level</span><span class="token punctuation">(</span><span class="token class-name">ModuleLogLevel</span> logLevel<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>logLevel <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"ModuleLogLevel is NULL when adapter to log4j2."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span>logLevel<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">case</span> TRACE<span class="token operator">:</span><span class="token keyword">return</span> <span class="token class-name">Level</span><span class="token punctuation">.</span>TRACE<span class="token punctuation">;</span><span class="token keyword">case</span> DEBUG<span class="token operator">:</span><span class="token keyword">return</span> <span class="token class-name">Level</span><span class="token punctuation">.</span>DEBUG<span class="token punctuation">;</span><span class="token keyword">case</span> INFO<span class="token operator">:</span><span class="token keyword">return</span> <span class="token class-name">Level</span><span class="token punctuation">.</span>INFO<span class="token punctuation">;</span><span class="token keyword">case</span> WARN<span class="token operator">:</span><span class="token keyword">return</span> <span class="token class-name">Level</span><span class="token punctuation">.</span>WARN<span class="token punctuation">;</span><span class="token keyword">case</span> ERROR<span class="token operator">:</span><span class="token keyword">return</span> <span class="token class-name">Level</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">;</span><span class="token keyword">default</span><span class="token operator">:</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>logLevel<span class="token operator">+</span> <span class="token string">" is unknown when adapter to log4j2."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Log4j2 loggerModuleFactory build error!"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶è¿™ä¸ªæ–¹æ¡ˆä¹Ÿæœ‰å…¶ç¼ºé™·ï¼ŒloggerContextå¯¹è±¡å¢åŠ äº†å¯¹åº”çš„å†…å­˜æ¶ˆè€—ä¹Ÿå°±å¢åŠ äº†ã€‚ç®€å•ç»Ÿè®¡äº†ä¸‹ï¼Œæ¯å¢åŠ ä¸€ä¸ªé‡‡ç”¨æ—¥å¿—éš”ç¦»æ¡†æ¶çš„æ¨¡å—ï¼Œå†…å­˜ä½¿ç”¨å¢åŠ <code>5~10kb</code>ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;&amp;emsp;&amp;emsp;æˆ‘ä»¬éƒ½çŸ¥é“æ—¥å¿—è‡³äºä»»ä½•ç³»ç»Ÿã€è½¯ä»¶éƒ½æ˜¯ååˆ†é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œé€šè¿‡æ—¥å¿—æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°äº†è§£åˆ°ç°åœ¨ç³»ç»Ÿè¿è¡Œæ˜¯å¦æ­£å¸¸ã€æ˜¯å¦æœ‰å¼‚å¸¸æƒ…å†µã€‚ä½†æœ‰æ—¶å€™æ—¥å¿—å¤ªå¤šäº†ä¹Ÿä¼šæœ‰å¹¸ç¦åœ°çƒ¦æ¼ï¼Œå‘ç”Ÿå¼‚å¸¸æƒ³é€šè¿‡æ—¥å¿—è¿›è¡Œæ’æŸ¥ï¼Œå¯æ˜¯æ»¡å±åœ°æ—¥å¿—éƒ½æ˜¯ä¸é‚£ä¹ˆé‡è¦åœ°å†…å®¹ï¼Œåƒå¿ƒè·³æ—¥å¿—ã€debugæ—¥å¿—ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&amp;emsp;&amp;emsp;è¿™åœ¨javaåº”ç”¨å°¤ä¸ºä¸¥é‡ï¼Œä½ æ¯å¼•å…¥åœ°ä¸€ä¸ªjaréƒ½æœ‰å¯èƒ½å¼•å…¥ä¸€å †æ‰“å°çš„æ—¥å¿—ï¼Œè¿™æ ·ä¸€æ¥è¦ä»æ—¥å¿—ä¸­æ‰¾åˆ°ä½ æ‰€éœ€è¦çš„å†…å®¹å°†æ˜¯ä¸€ä»¶æå…¶å›°éš¾çš„äº‹æƒ…ã€‚å½“ç„¶ï¼Œä½ ä¼šè¯´ï¼Œjavaæ‹¥æœ‰è¿™ä¹ˆå¤šä¼˜ç§€çš„æ—¥å¿—æ¡†æ¶ç³»ç»Ÿï¼Œå¯ä»¥ç®€å•åœ°é€šè¿‡ç›¸åº”åœ°é…ç½®æ–‡ä»¶å°†è¿™äº›å†…å®¹æ ¹æ®ä¸åŒçš„è¾“å‡ºçº§åˆ«è¾“å‡ºåˆ°ä¸åŒçš„ç›®å½•æ–‡ä»¶ï¼Œå¯æ˜¯å¦‚æœå°†è¿™ä»¶äº‹æƒ…éƒ½äº¤ç»™ç»ˆç«¯ç”¨æˆ·å»å¤„ç†ï¼Œé‚£å°†ä¼šæ˜¯ä¸€ä»¶æå…¶å¤æ‚çš„å·¥ç¨‹ï¼Œä»–å¾—æ˜ç™½å“ªäº›æ˜¯ä»–éœ€è¦çš„ã€å“ªäº›æ˜¯ä»–ä¸éœ€è¦çš„ï¼Œè€Œè¿™äº›ä¿¡æ¯åº”è¯¥æ˜¯å¯¹åº”çš„å¼€å‘äººå‘˜æœ€æ¸…æ¥šä¸è¿‡çš„ï¼Œå› æ­¤è®©å¼€å‘äººå‘˜æå‰å°†è¿™äº›æ—¥å¿—è¿›è¡Œå½’ç±»ï¼Œè¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œé‚£å¯¹åº”ä½¿ç”¨è€…æ¥è¯´å°†ä¼šå˜å¾—å¾ˆç®€å•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="http://blog.jobshen.com/categories/Java/"/>
    
    
    <category term="log" scheme="http://blog.jobshen.com/tags/log/"/>
    
    <category term="éš”ç¦»" scheme="http://blog.jobshen.com/tags/%E9%9A%94%E7%A6%BB/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºk8sä¸‹ä½¿ç”¨Ingressä¿æŒé•¿è¿æ¥çš„å¼‚å¸¸æƒ…å†µæ’æŸ¥</title>
    <link href="http://blog.jobshen.com/posts/eee2bd13.html"/>
    <id>http://blog.jobshen.com/posts/eee2bd13.html</id>
    <published>2019-01-02T14:19:02.000Z</published>
    <updated>2019-01-02T14:19:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><pre class="line-numbers language-none"><code class="language-none">åœ¨æˆ‘ä»¬ä¸­åº”ç”¨æœ‰ä¸€ä¸ªä½¿ç”¨åˆ°&#96;Http Long Poll&#96;çš„åœºæ™¯ï¼Œå®ƒéœ€è¦ä¸€ä¸ªhttpè¯·æ±‚ä¿æŒæœ€é•¿30ç§’ï¼Œç”¨äºå³ä½¿è·å–åˆ°æœ€æ–°çš„æ•°æ®ã€‚åœ¨k8sç¯å¢ƒä¸‹ï¼Œå‘ç°åº”è¯¥å­˜åœ¨å¶å‘çš„å¼‚å¸¸ï¼Œè¡¨ç°ä¸ºé•¿è¿æ¥æ²¡æœ‰æ­£å¸¸å…³é—­ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼š<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span><span class="token class-name">SocketException</span><span class="token operator">:</span> <span class="token class-name">Unexpected</span> end of file from server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><a id="more"></a><h2 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h2><h3 id="åº”ç”¨å¼‚å¸¸æ’æŸ¥"><a href="#åº”ç”¨å¼‚å¸¸æ’æŸ¥" class="headerlink" title="åº”ç”¨å¼‚å¸¸æ’æŸ¥"></a>åº”ç”¨å¼‚å¸¸æ’æŸ¥</h3><p>&emsp;&emsp;é¦–å…ˆæˆ‘ä»¬å…ˆå¯¹åº”ç”¨ç¨‹åºçš„ä»£ç è¿›è¡Œäº†æ’æŸ¥ï¼Œå¹¶æ²¡æœ‰å‘ç°ä»£ç ä¸Šçš„bugï¼Œå¯ä»¥æ’é™¤æ˜¯ç”±äºä»£ç bugå¯¼è‡´çš„è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h3><p>&emsp;&emsp;æ¥ä¸‹æ¥è€ƒè™‘çš„æ–¹å¼å°±æ˜¯æŠ“åŒ…ï¼Œåˆ†åˆ«åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡ŒæŠ“åŒ…ï¼šåº”ç”¨ç¨‹åºæ‰€åœ¨podã€ingress-nginxæ‰€åœ¨podã€æœåŠ¡ç«¯podã€‚</p><p>åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹shellè„šæœ¬ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tcpdump tcp -s 0  -w .&#x2F;target.cap<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŠ“å–å½“å‰ç½‘å¡ä¸‹çš„æ‰€æœ‰tcpæµé‡ï¼Œç„¶åä½¿ç”¨wiresharkè¿›è¡Œåˆ†æã€‚å‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„ç°è±¡ï¼š</p><p><img data-src="https://picture.jobshen.com/blog/tcpdump/client-tcpdump.png" alt="client-tcpdump.png"></p><p><img data-src="https://picture.jobshen.com/blog/tcpdump/nginx-tcpdump.png" alt="nginx-tcpdump.png"></p><p><img data-src="https://picture.jobshen.com/blog/tcpdump/server-tcpdump.png" alt="server-tcpdump.png"></p><p>ä»ä¸Šåˆ°ä¸‹ä¸‰å¼ å›¾ç‰‡åˆ†åˆ«æ˜¯åº”ç”¨ç¨‹åºç«¯ã€nginxç«¯ã€æœåŠ¡ç«¯çš„æŠ“åŒ…æ•°æ®ï¼Œå¯ä»¥å‘ç°è¿æ¥çš„å…³é—­æ˜¯ç”±nginxè¿™ä¸ªèŠ‚ç‚¹å‘èµ·çš„ï¼Œåº”ç”¨ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶æ”¶åˆ°äº†æ¥è‡ªnginxçš„<code>FIN ACK</code>åŒ…ï¼Œè¦æ±‚å…³é—­å½“å‰è¿æ¥ï¼Œå¹¶ä¸”éƒ½å¼€å§‹æ‰§è¡Œå››æ¬¡æ¡æ‰‹è¿‡ç¨‹ã€‚ä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åˆå‘ç”Ÿäº†ä»€ä¹ˆå¼‚å¸¸å¯¼è‡´è¿™ä¸ªè¿‡ç¨‹å¹¶æ²¡æœ‰æ­£å¸¸å®Œæˆã€‚</p><p>é€šè¿‡è§‚å¯Ÿå¤§é‡çš„æŠ“åŒ…æ•°æ®åå‘ç°è¿™ä¸ªæƒ…å†µå‘ç”Ÿçš„éå¸¸å¤šï¼Œä½†å¹¶ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šå¯¼è‡´è¿æ¥çš„å¼‚å¸¸å…³é—­ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯èƒ½å¤Ÿæ­£å¸¸å…³é—­è¿æ¥å¹¶å»ºç«‹æ–°çš„è¿æ¥çš„ã€‚</p><p>é€šè¿‡ä»”ç»†è§‚å¯Ÿå‘ç°è¢«å¼‚å¸¸å…³é—­çš„è¿æ¥ï¼Œéƒ½æ˜¯å‘ç”Ÿåœ¨<code>Seq=1</code>çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåŸå› è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚</p><p>é‚£ä¸ºä»€ä¹ˆ<strong>nginx</strong>ä¼šä¸»åŠ¨å‘èµ·å…³é—­è¿æ¥å‘¢ï¼Ÿ</p><h3 id="Nginx-æ’æŸ¥"><a href="#Nginx-æ’æŸ¥" class="headerlink" title="Nginx æ’æŸ¥"></a>Nginx æ’æŸ¥</h3><p>&emsp;&emsp;è¿™æ—¶å€™é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯nginxçš„æ—¥å¿—ï¼Œåœ¨ç¿»æŸ¥äº†nginxçš„<code>access.log</code>åï¼Œå‘ç°åœ¨ç›¸åŒçš„æ—¶é—´ç«¯ï¼Œnginxéƒ½å‘ç”Ÿäº†<code>reload</code>ç°è±¡ï¼š</p><pre class="line-numbers language-none"><code class="language-none">backend reload requiredingress backend successfully reloaded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>éš¾é“æ˜¯ç”±äºnginxçš„reloadå¯¼è‡´çš„é—®é¢˜å—ï¼Ÿ</p><p>é€šè¿‡æŸ¥è¯¢å‘ç°ï¼Œnginx reloadçš„å¤§è‡´æµç¨‹ä¸ºï¼š</p><ul><li>reloadå‘½ä»¤è§¦å‘nginxç”Ÿæˆæ–°çš„workerè¿›ç¨‹ç”¨äºæ¥å—æ–°çš„è¿æ¥è¯·æ±‚</li><li><code>old worker</code> è¿›ç¨‹ä¸å†æ¥å—è¯·æ±‚</li><li>å¯¹äºä»ç„¶å­˜åœ¨äº<code>old worker</code>è¿›ç¨‹ä¸Šçš„<code>keep alive</code>çš„è¿æ¥ï¼Œä¸»åŠ¨å‘é€<code>FIN ACK</code> åŒ…ï¼Œé€šçŸ¥å¯¹æ–¹å…³é—­å½“å‰è¿æ¥</li><li>å½“æ‰€æœ‰old worker ä¸Šçš„è¿æ¥éƒ½å…³é—­æˆ–è€…è¶…è¿‡<code>worker-shutdown-timeout</code>æ‰€è®¾å®šçš„æ—¶é—´åï¼Œä¼šå…³é—­old worker è¿›ç¨‹</li></ul><p>&emsp;&emsp;é€šè¿‡æŸ¥è¯¢k8sä¸Šingressçš„é»˜è®¤é…ç½®å‘ç°ï¼Œ<code> worker-shutdown-timeout</code>è¢«è®¾ç½®ä¸ºäº†10sï¼Œè¿™æ—¶å€™åŸºæœ¬å¯ä»¥ç¡®å®šé—®é¢˜äº†ï¼Œç”±äº<code>old worker</code>å…³é—­çš„çª—å£æ—¶é—´åªæœ‰10sï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…æœ‰è¿æ¥è¿˜æ²¡æœ‰å®Œæˆå…³é—­ï¼Œè€Œæ­¤æ—¶<code>old worker</code>å·²ç»è¢«å…³é—­äº†ï¼Œclientç«¯å½“ç„¶ä¸èƒ½æ­£å¸¸å¤„ç†è¯·æ±‚ï¼Œå› ä¸ºå®ƒæ‰€è¿æ¥çš„serverç«¯å·²ç»è¢«æå‰å…³é—­äº†ã€‚</p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>&emsp;&emsp;æ‰¾åˆ°é—®é¢˜åŸå› äº†å½“ç„¶æ¥ä¸‹æ¥å°±æ˜¯è§£å†³äº†ï¼Œå°†<code> worker-shutdown-timeout</code>è¯¥å­—æ®µçš„å€¼å¢å¤§ä¸ºï¼š3600sï¼Œå³1å°æ—¶ï¼Œç†è®ºä¸Šè¿™ä¸ªæ—¶é—´è¶³å¤Ÿè¯¥workerä¸Šçš„è¿æ¥å…¨éƒ¨å®Œæˆå…³é—­äº†ã€‚</p><p>åœ¨è°ƒæ•´äº†k8sä¸Šingressçš„è¿™ä¸ªå‚æ•°åï¼Œåˆè¿›è¡Œäº†åå¤æµ‹è¯•ï¼Œå¹¶æ²¡æœ‰å†æ¬¡å‘ç°åŒæ ·çš„é—®é¢˜ï¼Œè¯¥é—®é¢˜å¾—åˆ°è§£å†³ã€‚</p><h2 id="é—ç•™"><a href="#é—ç•™" class="headerlink" title="é—ç•™"></a>é—ç•™</h2><p>&emsp;&emsp;ç„¶åï¼Œä¸ºä»€ä¹ˆæ˜¯<code>Seq=1</code>çš„è¿æ¥ä¼šå‘ç”Ÿè¿™ä¸ªå¼‚å¸¸ï¼Œè¿˜æ˜¯æ²¡æœ‰å®Œå…¨æƒ³æ˜ç™½ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-none&quot;&gt;&lt;code class=&quot;language-none&quot;&gt;åœ¨æˆ‘ä»¬ä¸­åº”ç”¨æœ‰ä¸€ä¸ªä½¿ç”¨åˆ°&amp;#96;Http Long Poll&amp;#96;çš„åœºæ™¯ï¼Œå®ƒéœ€è¦ä¸€ä¸ªhttpè¯·æ±‚ä¿æŒæœ€é•¿30ç§’ï¼Œç”¨äºå³ä½¿è·å–åˆ°æœ€æ–°çš„æ•°æ®ã€‚åœ¨k8sç¯å¢ƒä¸‹ï¼Œå‘ç°åº”è¯¥å­˜åœ¨å¶å‘çš„å¼‚å¸¸ï¼Œè¡¨ç°ä¸ºé•¿è¿æ¥æ²¡æœ‰æ­£å¸¸å…³é—­ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼š&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;net&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SocketException&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Unexpected&lt;/span&gt; end of file from server&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;</summary>
    
    
    
    <category term="k8s" scheme="http://blog.jobshen.com/categories/k8s/"/>
    
    
    <category term="k8s" scheme="http://blog.jobshen.com/tags/k8s/"/>
    
    <category term="ingress" scheme="http://blog.jobshen.com/tags/ingress/"/>
    
    <category term="nginx" scheme="http://blog.jobshen.com/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Centos-7ä¸‹å¸¸è§ä¸­é—´ä»¶ç¯å¢ƒçš„å®‰è£…ï¼ˆä¸‰ï¼‰</title>
    <link href="http://blog.jobshen.com/posts/3335490502.html"/>
    <id>http://blog.jobshen.com/posts/3335490502.html</id>
    <published>2017-12-17T12:29:46.000Z</published>
    <updated>2017-12-17T12:29:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;æ¥ç€ä¸Šç¯‡æ–‡ç« ï¼Œç°åœ¨å¼€å§‹éƒ¨ç½²Redisé›†ç¾¤ï¼Œé‡‡ç”¨æ–¹æ¡ˆä¸ºå››ä¸»å››ä»ï¼Œæš‚æ—¶ä¸è€ƒè™‘æ­å»ºå“¨å…µï¼Œå› æ­¤éœ€è¦å…«å°æœºå™¨ï¼Œä»¥ä¸‹æ˜¯éƒ¨ç½²è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•ã€‚</p><a id="more"></a><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="é›†ç¾¤æœºå™¨ä¿¡æ¯"><a href="#é›†ç¾¤æœºå™¨ä¿¡æ¯" class="headerlink" title="é›†ç¾¤æœºå™¨ä¿¡æ¯"></a>é›†ç¾¤æœºå™¨ä¿¡æ¯</h3><table><thead><tr><th align="center">IP</th><th align="center">CPUã€RAM</th></tr></thead><tbody><tr><td align="center">10.100.1.31</td><td align="center">16 vcpuã€64G ram</td></tr><tr><td align="center">10.100.1.32</td><td align="center">16 vcpuã€64G ram</td></tr><tr><td align="center">10.100.1.33</td><td align="center">16 vcpuã€64G ram</td></tr><tr><td align="center">10.100.1.34</td><td align="center">16 vcpuã€64G ram</td></tr><tr><td align="center">10.100.1.35</td><td align="center">16 vcpuã€64G ram</td></tr><tr><td align="center">10.100.1.36</td><td align="center">16 vcpuã€64G ram</td></tr><tr><td align="center">10.100.1.37</td><td align="center">16 vcpuã€64G ram</td></tr><tr><td align="center">10.100.1.38</td><td align="center">16 vcpuã€64G ram</td></tr></tbody></table><p><em>Redis ä¸ºå†…å­˜æ•°æ®åº“ï¼Œå› æ­¤æœºå™¨å†…å­˜å¿…é¡»è¾ƒå¤§ï¼Œæ ¹æ®ç»éªŒï¼ŒRediså ç”¨å†…å­˜ä¸€èˆ¬ä¸èƒ½è¶…è¿‡æœºå™¨å†…å­˜çš„ä¸€åŠï¼Œä¸å¦åˆ™Redisçš„æ€§èƒ½å°±ä¼šå¼€å§‹ä¸‹é™</em></p><h3 id="Redisç¼–è¯‘"><a href="#Redisç¼–è¯‘" class="headerlink" title="Redisç¼–è¯‘"></a>Redisç¼–è¯‘</h3><p>ç”±äºRediså¹¶ä¸èƒ½é€šè¿‡åŒ…ç®¡ç†å·¥å…·ï¼ˆä¾‹å¦‚ <em>yum</em>ã€<em>apt-get</em>ç­‰ï¼‰è¿›è¡Œå¿«é€Ÿå®‰è£…ï¼Œåªèƒ½ä¸‹è½½æºç è¿›è¡Œç¼–è¯‘å®‰è£…ã€‚</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local$ curl -O http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-4.0.6.tar.gzjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ tar -zxf redis-4.0.6.tar.gzjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ ln -s redis-4.0.6 redisjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ cd redisjobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ make &amp;&amp; make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Redis-Cluster-éƒ¨ç½²"><a href="#Redis-Cluster-éƒ¨ç½²" class="headerlink" title="Redis Cluster éƒ¨ç½²"></a>Redis Cluster éƒ¨ç½²</h2><h3 id="Redis-conf"><a href="#Redis-conf" class="headerlink" title="Redis.conf"></a>Redis.conf</h3><p>æ–°å»º*<strong>cluster**<em>æ–‡ä»¶å¤¹ï¼Œä»¥åŠæ–°å»º</em></strong>redis.conf***æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ mkdir clusterjobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ vim cluster&#x2F;redis.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">bind 10.100.1.31 127.0.0.1protected-mode yesport 6379daemonize yessupervised systemdpidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pidlogfile &quot;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;cluster&#x2F;redis.log&quot;databases 16save 900 1save 300 10save 60 10000stop-writes-on-bgsave-error yesdbfilename dump.rdbslave-serve-stale-data yesslave-read-only yesslave-priority 100maxmemory 34359738368appendonly yescluster-enabled yescluster-config-file nodes-6379.confcluster-node-timeout 15000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Redis-service"><a href="#Redis-service" class="headerlink" title="Redis.service"></a>Redis.service</h3><p>åˆ›å»º<em>systemd</em>æœåŠ¡ï¼Œ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;redis.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[Unit]Description&#x3D;RedisAfter&#x3D;network.target[Service]ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;src&#x2F;redis-server &#x2F;usr&#x2F;local&#x2F;redis&#x2F;cluster&#x2F;redis.conf --daemonize noExecStop&#x3D;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;src&#x2F;redis-cli -h 127.0.0.1 -p 6379 shutdown[Install]WantedBy&#x3D;multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¯åŠ¨Redis"><a href="#å¯åŠ¨Redis" class="headerlink" title="å¯åŠ¨Redis"></a>å¯åŠ¨Redis</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ systemctl start redis<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="åˆ›å»ºRedisé›†ç¾¤"><a href="#åˆ›å»ºRedisé›†ç¾¤" class="headerlink" title="åˆ›å»ºRedisé›†ç¾¤"></a>åˆ›å»ºRedisé›†ç¾¤</h3><p>ä»¥ä¸‹å‘½ä»¤å¯ä»¥åªåœ¨ä¸€å°æœºå™¨ä¸Šæ‰§è¡Œï¼Œä½†ä¸ºäº†åæœŸç»´æŠ¤Redisé›†ç¾¤æ–¹ä¾¿ï¼Œå¯ä»¥åœ¨æ‰€æœ‰redisæœºå™¨ä¸Šéƒ½å®‰è£…é›†ç¾¤ç®¡ç†å·¥å…·ã€‚</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ gpg --keyserver hkp:&#x2F;&#x2F;keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDBjobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ curl -sSL https:&#x2F;&#x2F;get.rvm.io | bash -s stablejobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ rvm install 2.4.3jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ rvm use 2.4.3 --default --createjobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ gem install redisjobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ .&#x2F;src&#x2F;redis-trib.rb create --replicas 1 10.100.1.31:6379 10.100.1.32:6379 10.100.1.33:6379 10.100.1.34:6379 10.100.1.35:6379 10.100.1.36:6379 10.100.1.37:6379 10.100.1.38:6379<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>ç™»å…¥ä»»æ„ä¸€å°redisï¼ŒæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;redis$ .&#x2F;src&#x2F;redis-cli -c -p 6369127.0.0.1:6379&gt; cluster nodes31f29a40699e44ae9b0dce5c8ded53cc92546c7f 10.100.1.31:6379@16379 master - 0 1513599855000 2 connected 4096-8191bd148fc244c821f0ebc502e2ef80e90e3ce8020f 10.100.1.32:6379@16379 master - 0 1513599857582 4 connected 12288-1638324c0c11cceb08a0a2c0f76773a1c3ecb5553fdd1 10.100.1.33:6379@16379 slave bd148fc244c821f0ebc502e2ef80e90e3ce8020f 0 1513599857000 8 connectedb8ed99aef612d728f69015b20dae32751af5a668 10.100.1.34:6379@16379 myself,master - 0 1513599854000 1 connected 0-4095ee420f56a64c89c519c82adf2131724456656711 10.100.1.35:6379@16379 slave b8ed99aef612d728f69015b20dae32751af5a668 0 1513599856000 5 connectedfa8f3b33ed93a8bb76c3f44b410436f12ca45d8c 10.100.1.36:6379@16379 slave 914483a3760cc5f7fc4422ea3326f39b0fc505b4 0 1513599854000 7 connected914483a3760cc5f7fc4422ea3326f39b0fc505b4 10.100.1.37:6379@16379 master - 0 1513599854000 3 connected 8192-12287da57f16f2f5b86cae95478157723c9b2972d460d 10.100.1.38:6379@16379 slave 31f29a40699e44ae9b0dce5c8ded53cc92546c7f 0 1513599854000 6 connected127.0.0.1:6379&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæ•´ä¸ª<em>Redisé›†ç¾¤</em>çš„æ­å»ºå°±å®Œæˆäº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&amp;emsp;&amp;emsp;æ¥ç€ä¸Šç¯‡æ–‡ç« ï¼Œç°åœ¨å¼€å§‹éƒ¨ç½²Redisé›†ç¾¤ï¼Œé‡‡ç”¨æ–¹æ¡ˆä¸ºå››ä¸»å››ä»ï¼Œæš‚æ—¶ä¸è€ƒè™‘æ­å»ºå“¨å…µï¼Œå› æ­¤éœ€è¦å…«å°æœºå™¨ï¼Œä»¥ä¸‹æ˜¯éƒ¨ç½²è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="centos7" scheme="http://blog.jobshen.com/categories/centos7/"/>
    
    
    <category term="Redis" scheme="http://blog.jobshen.com/tags/Redis/"/>
    
    <category term="Redis Cluster" scheme="http://blog.jobshen.com/tags/Redis-Cluster/"/>
    
  </entry>
  
  <entry>
    <title>Centos-7ä¸‹å¸¸è§ä¸­é—´ä»¶ç¯å¢ƒçš„å®‰è£…ï¼ˆäºŒï¼‰</title>
    <link href="http://blog.jobshen.com/posts/2345740436.html"/>
    <id>http://blog.jobshen.com/posts/2345740436.html</id>
    <published>2017-12-09T12:53:12.000Z</published>
    <updated>2017-12-09T12:53:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;æ¥ç€ä¸Šç¯‡æ–‡ç« ï¼Œç°åœ¨å¼€å§‹éƒ¨ç½²RocketMQé›†ç¾¤ï¼Œé‡‡ç”¨çš„éƒ¨ç½²æ–¹æ¡ˆæ˜¯é˜¿é‡Œæ¨èçš„ä¸¤ä¸»ä¸¤ä»å¼‚æ­¥åˆ·ç›˜çš„æ¨¡å¼ï¼Œå› æ­¤å‡†å¤‡äº†å››å°æœåŠ¡å™¨æ¥è¿›è¡ŒMQé›†ç¾¤çš„éƒ¨ç½²ï¼Œä»¥ä¸‹æ˜¯éƒ¨ç½²è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•ï¼Œ</p><a id="more"></a><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="é›†ç¾¤æœºå™¨ä¿¡æ¯"><a href="#é›†ç¾¤æœºå™¨ä¿¡æ¯" class="headerlink" title="é›†ç¾¤æœºå™¨ä¿¡æ¯"></a>é›†ç¾¤æœºå™¨ä¿¡æ¯</h3><table><thead><tr><th align="center">IP</th><th align="center">CPUã€RAM</th><th align="center">ä½œç”¨</th></tr></thead><tbody><tr><td align="center">10.100.1.21</td><td align="center">16 vcpuã€64G ram</td><td align="center">broker-a master</td></tr><tr><td align="center">10.100.1.22</td><td align="center">16 vcpuã€64G ram</td><td align="center">broker-b master</td></tr><tr><td align="center">10.100.1.23</td><td align="center">16 vcpuã€64G ram</td><td align="center">nameserverã€broker-a slave</td></tr><tr><td align="center">10.100.1.24</td><td align="center">16 vcpuã€64G ram</td><td align="center">nameserverã€broker-b-slave</td></tr></tbody></table><h3 id="è¿è¡Œç¯å¢ƒ"><a href="#è¿è¡Œç¯å¢ƒ" class="headerlink" title="è¿è¡Œç¯å¢ƒ"></a>è¿è¡Œç¯å¢ƒ</h3><p>è¿™æ¬¡é‡‡ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬4.2.-0-SNAPSHOTï¼Œæ‰€ä»¥jdkéœ€è¦é‡‡ç”¨ <em>jdk8</em> ï¼ŒæŒ‰ç…§ä¸Šä¸€ç¯‡æ–‡ç« å°†jdkå…¨éƒ¨å®‰è£…å¥½ã€‚</p><h3 id="Maven-å®‰è£…"><a href="#Maven-å®‰è£…" class="headerlink" title="Maven å®‰è£…"></a>Maven å®‰è£…</h3><p>Apacheç°åœ¨å¹¶æ²¡æœ‰æä¾›RocketMQç¼–è¯‘å¥½çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±ä¸‹è½½æºç è¿›è¡Œç¼–è¯‘ï¼Œç”±äºrocketmqæ˜¯é€šè¿‡<strong>maven</strong>è¿›è¡ŒåŒ…ç®¡ç†çš„ï¼Œæ‰€ä»¥è¦å…ˆå®‰è£…mavenã€‚</p><ul><li>ä¸‹è½½</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local$ curl -O http:&#x2F;&#x2F;mirrors.hust.edu.cn&#x2F;apache&#x2F;maven&#x2F;maven-3&#x2F;3.5.2&#x2F;binaries&#x2F;apache-maven-3.5.2-bin.tar.gzjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ tar -zxf apache-maven-3.5.2-bin.tar.gzjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ vim apache-maven-3.5.2&#x2F;conf&#x2F;settings.xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>ä¿®æ”¹mirror é•œåƒæºï¼Œæ”¹ä¸ºé˜¿é‡Œäº‘çš„é•œåƒï¼š</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrors</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>nexus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>external:*,!spring-milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>http://maven.aliyun.com/nexus/content/groups/public<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrors</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è®¾ç½®ç¯å¢ƒå˜é‡</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local$ vim &#x2F;etc&#x2F;profile&#x2F;&#x2F; åœ¨æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹export M2_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-maven-3.5.2&#x2F;binexport PATH&#x3D;$M2_HOME&#x2F;bin:$PATH&#x2F;&#x2F; ä¿å­˜ ä½¿å…¶ç”Ÿæ•ˆjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ source &#x2F;etc&#x2F;profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="RocketMQ-ç¼–è¯‘"><a href="#RocketMQ-ç¼–è¯‘" class="headerlink" title="RocketMQ ç¼–è¯‘"></a>RocketMQ ç¼–è¯‘</h3><ul><li>å…‹éš†ä»£ç ç¼–è¯‘</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local$ git clone -b develop https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;rocketmq.gitjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ cd rocketmqjobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;rocketmq$ mvn -Prelease-all -DskipTests clean install -Ujobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;rocketmq$ cd distribution&#x2F;targetjobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;rocketmq$ cp apache-rocketmq.tar.gz &#x2F;usr&#x2F;local&#x2F;apache-rocketmq.tar.gzjobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;rocketmq$ cd &#x2F;usr&#x2F;localjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ tar -zxf apache-rocketmq.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å°†å‹ç¼©åŒ…æ‹·è´åˆ°é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ï¼Œå¹¶è§£å‹</li></ul><h2 id="RocketMQ-éƒ¨ç½²"><a href="#RocketMQ-éƒ¨ç½²" class="headerlink" title="RocketMQ éƒ¨ç½²"></a>RocketMQ éƒ¨ç½²</h2><h3 id="ä¿®æ”¹ç›®å½•é…ç½®ä¿¡æ¯"><a href="#ä¿®æ”¹ç›®å½•é…ç½®ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹ç›®å½•é…ç½®ä¿¡æ¯"></a>ä¿®æ”¹ç›®å½•é…ç½®ä¿¡æ¯</h3><ul><li>log æ—¥å¿—æ ¹ç›®å½• store å­˜å‚¨æ ¹ç›®å½•</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local$ mkdir -p rocketmq_data&#x2F;logs rocketmq_data&#x2F;store<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ä¿®æ”¹æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­è·¯å¾„</li></ul><p>å°†<code>logback_broker.xml </code> ã€<code>logback_filtersrv.xml</code> ã€<code>logback_broker.xml</code>ã€<code>logback_namesrv.xml</code>ã€<code>logback_tools.xml</code>ä¸­çš„<code>$&#123;user.home&#125;</code> ä¿®æ”¹ä¸º <code>/usr/local/rocketmq_data</code></p><h3 id="éƒ¨ç½²NameServer"><a href="#éƒ¨ç½²NameServer" class="headerlink" title="éƒ¨ç½²NameServer"></a>éƒ¨ç½²NameServer</h3><ul><li>åœ¨<code>10.100.1.23</code>ã€<code>10.100.1.24</code>ä¸¤å°æœºå™¨ä¸Šæ·»åŠ  <strong><em>nameserver</em></strong> é…ç½®æ–‡ä»¶ï¼š<code>nameserver.properties</code>ï¼š</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local$ mkdir apache-rocketmq&#x2F;conf&#x2F;productjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ vim apache-rocketmq&#x2F;conf&#x2F;product&#x2F;nameserver.properties<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">rocketmqHome</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/apache-rocketmq</span><span class="token attr-name">kvConfigPath</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/rocketmq_data/store/namesrv/kvConfig.json</span><span class="token attr-name">listenPort</span><span class="token punctuation">=</span><span class="token attr-value">9876</span><span class="token attr-name">serverWorkerThreads</span><span class="token punctuation">=</span><span class="token attr-value">16</span><span class="token attr-name">serverCallbackExecutorThreads</span><span class="token punctuation">=</span><span class="token attr-value">0</span><span class="token attr-name">serverSelectorThreads</span><span class="token punctuation">=</span><span class="token attr-value">6</span><span class="token attr-name">serverOnewaySemaphoreValue</span><span class="token punctuation">=</span><span class="token attr-value">512</span><span class="token attr-name">serverAsyncSemaphoreValue</span><span class="token punctuation">=</span><span class="token attr-value">128</span><span class="token attr-name">serverChannelMaxIdleTimeSeconds</span><span class="token punctuation">=</span><span class="token attr-value">240</span><span class="token attr-name">serverSocketSndBufSize</span><span class="token punctuation">=</span><span class="token attr-value">4096</span><span class="token attr-name">serverSocketRcvBufSize</span><span class="token punctuation">=</span><span class="token attr-value">2048</span><span class="token attr-name">serverPooledByteBufAllocatorEnable</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¿®æ”¹<code>jvm</code>å¯åŠ¨å‚æ•°ï¼š</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ vim bin&#x2F;runserver.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#!&#x2F;bin&#x2F;sh# Licensed to the Apache Software Foundation (ASF) under one or more# contributor license agreements.  See the NOTICE file distributed with# this work for additional information regarding copyright ownership.# The ASF licenses this file to You under the Apache License, Version 2.0# (the &quot;License&quot;); you may not use this file except in compliance with# the License.  You may obtain a copy of the License at##     http:&#x2F;&#x2F;www.apache.org&#x2F;licenses&#x2F;LICENSE-2.0## Unless required by applicable law or agreed to in writing, software# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.# See the License for the specific language governing permissions and# limitations under the License.#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;# Java Environment Setting#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;error_exit ()&#123;    echo &quot;ERROR: $1 !!&quot;    exit 1&#125;[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; JAVA_HOME&#x3D;$HOME&#x2F;jdk&#x2F;java[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; JAVA_HOME&#x3D;&#x2F;usr&#x2F;java[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; error_exit &quot;Please set the JAVA_HOME variable in your environment, We need java(x64)!&quot;export JAVA_HOMEexport JAVA&#x3D;&quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot;export BASE_DIR&#x3D;$(dirname $0)&#x2F;..export CLASSPATH&#x3D;.:$&#123;BASE_DIR&#125;&#x2F;conf:$&#123;CLASSPATH&#125;#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;# JVM Configuration#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -server -Xms16g -Xmx16g -Xmn4g -XX:MetaspaceSize&#x3D;256m -XX:MaxMetaspaceSize&#x3D;1024m -XX:+AlwaysPreTouch -XX:-UseBiasedLocking&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:+UseG1GC -XX:G1HeapRegionSize&#x3D;50m -XX:G1ReservePercent&#x3D;25 -XX:InitiatingHeapOccupancyPercent&#x3D;30&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles&#x3D;5 -XX:GCLogFileSize&#x3D;30m -verbose:gc -Xloggc:&#x2F;dev&#x2F;shm&#x2F;rmq_srv_gc.log -XX:+PrintGCDetails&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:-OmitStackTraceInFastThrow&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125;  -XX:-UseLargePages&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -Djava.ext.dirs&#x3D;$&#123;JAVA_HOME&#125;&#x2F;jre&#x2F;lib&#x2F;ext:$&#123;BASE_DIR&#125;&#x2F;lib&quot;#JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -Xdebug -Xrunjdwp:transport&#x3D;dt_socket,address&#x3D;9555,server&#x3D;y,suspend&#x3D;n&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; $&#123;JAVA_OPT_EXT&#125;&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -cp $&#123;CLASSPATH&#125;&quot;$JAVA $&#123;JAVA_OPT&#125; $@<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ¶ä½œ<code>systemd</code>è„šæœ¬ï¼šnamesrv.service</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;namesrv.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[Unit]Description&#x3D;RocketMQ-NameserverAfter&#x3D;network.target[Service]ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-rocketmq&#x2F;bin&#x2F;mqnamesrv -c &#x2F;usr&#x2F;local&#x2F;apache-rocketmq&#x2F;conf&#x2F;product&#x2F;namesrv.propertiesExecStop&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-rocketmq&#x2F;bin&#x2F;mqshutdown namesrv[Install]WantedBy&#x3D;multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ ln -s &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;namesrv.service &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;namesrv.servicejobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ systemctl daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨**<em>nameserver**</em></li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ systemctl start namesrv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="éƒ¨ç½²Broker"><a href="#éƒ¨ç½²Broker" class="headerlink" title="éƒ¨ç½²Broker"></a>éƒ¨ç½²Broker</h3><h4 id="éƒ¨ç½²broker-a"><a href="#éƒ¨ç½²broker-a" class="headerlink" title="éƒ¨ç½²broker-a"></a>éƒ¨ç½²broker-a</h4><h5 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h5><ul><li>åœ¨<code>10.100.1.21</code>ä¸Šæ–°å»º<code>broker-a-master.properties</code>æ–‡ä»¶ï¼š</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local$ mkdir apache-rocketmq&#x2F;conf&#x2F;productjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ vim apache-rocketmq&#x2F;conf&#x2F;product&#x2F;broker-a-master.properties<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">rocketmqHome</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/apache-rocketmq</span><span class="token attr-name">namesrvAddr</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.23:9876;10.100.1.24:9876</span><span class="token attr-name">brokerIP1</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.21</span><span class="token attr-name">brokerIP2</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.21</span><span class="token attr-name">brokerName</span><span class="token punctuation">=</span><span class="token attr-value">mq_a</span><span class="token attr-name">brokerClusterName</span><span class="token punctuation">=</span><span class="token attr-value">ProductCluster</span><span class="token attr-name">brokerId</span><span class="token punctuation">=</span><span class="token attr-value">0</span><span class="token attr-name">defaultTopicQueueNums</span><span class="token punctuation">=</span><span class="token attr-value">16</span><span class="token attr-name">autoCreateTopicEnable</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token attr-name">clusterTopicEnable</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">brokerTopicEnable</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">autoCreateSubscriptionGroup</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">listenPort</span><span class="token punctuation">=</span><span class="token attr-value">10911</span><span class="token attr-name">storePathRootDir</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/rocketmq_data/store</span><span class="token attr-name">storePathCommitLog</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/rocketmq_data/store/commitlog/</span><span class="token attr-name">storePathConsumerQueue</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/rocketmq_data/store/consumequeue/</span><span class="token attr-name">mapedFileSizeCommitLog</span><span class="token punctuation">=</span><span class="token attr-value">1073741824</span><span class="token attr-name">mapedFileSizeConsumeQueue</span><span class="token punctuation">=</span><span class="token attr-value">6000000</span><span class="token attr-name">deleteWhen</span><span class="token punctuation">=</span><span class="token attr-value">04</span><span class="token attr-name">diskMaxUsedSpaceRatio</span><span class="token punctuation">=</span><span class="token attr-value">75</span><span class="token attr-name">fileReserverdTime</span><span class="token punctuation">=</span><span class="token attr-value">72</span><span class="token attr-name">haListenPort</span><span class="token punctuation">=</span><span class="token attr-value">10912</span><span class="token attr-name">haSendHeartbeatInterval</span><span class="token punctuation">=</span><span class="token attr-value">5000</span><span class="token attr-name">haHousekeepingInterval</span><span class="token punctuation">=</span><span class="token attr-value">20000</span><span class="token attr-name">haTransferBatchSize</span><span class="token punctuation">=</span><span class="token attr-value">32768</span><span class="token attr-name">haMasterAddress</span><span class="token punctuation">=</span><span class="token attr-name">haSlaveFallbehindMax</span><span class="token punctuation">=</span><span class="token attr-value">268435456</span><span class="token attr-name">brokerRole</span><span class="token punctuation">=</span><span class="token attr-value">ASYNC_MASTER</span><span class="token attr-name">flushDiskType</span><span class="token punctuation">=</span><span class="token attr-value">ASYNC_FLUSH</span><span class="token attr-name">syncFlushTimeout</span><span class="token punctuation">=</span><span class="token attr-value">5000</span><span class="token attr-name">messageDelayLevel</span><span class="token punctuation">=</span><span class="token attr-value">1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h</span><span class="token attr-name">flushDelayOffsetInterval</span><span class="token punctuation">=</span><span class="token attr-value">10000</span><span class="token attr-name">cleanFileForciblyEnable</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¿®æ”¹<code>jvm</code>å¯åŠ¨å‚æ•°ï¼š</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ vim bin&#x2F;runbroker.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#!&#x2F;bin&#x2F;sh# Licensed to the Apache Software Foundation (ASF) under one or more# contributor license agreements.  See the NOTICE file distributed with# this work for additional information regarding copyright ownership.# The ASF licenses this file to You under the Apache License, Version 2.0# (the &quot;License&quot;); you may not use this file except in compliance with# the License.  You may obtain a copy of the License at##     http:&#x2F;&#x2F;www.apache.org&#x2F;licenses&#x2F;LICENSE-2.0## Unless required by applicable law or agreed to in writing, software# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.# See the License for the specific language governing permissions and# limitations under the License.#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;# Java Environment Setting#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;error_exit ()&#123;    echo &quot;ERROR: $1 !!&quot;    exit 1&#125;[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; JAVA_HOME&#x3D;$HOME&#x2F;jdk&#x2F;java[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; JAVA_HOME&#x3D;&#x2F;usr&#x2F;java[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; error_exit &quot;Please set the JAVA_HOME variable in your environment, We need java(x64)!&quot;export JAVA_HOMEexport JAVA&#x3D;&quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot;export BASE_DIR&#x3D;$(dirname $0)&#x2F;..export CLASSPATH&#x3D;.:$&#123;BASE_DIR&#125;&#x2F;conf:$&#123;CLASSPATH&#125;#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;# JVM Configuration#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -server -Xms48g -Xmx48g -Xmn24g&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:+UseG1GC -XX:G1HeapRegionSize&#x3D;64m -XX:G1ReservePercent&#x3D;25 -XX:InitiatingHeapOccupancyPercent&#x3D;30 -XX:SoftRefLRUPolicyMSPerMB&#x3D;0 -XX:SurvivorRatio&#x3D;8&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -verbose:gc -Xloggc:&#x2F;dev&#x2F;shm&#x2F;mq_gc_%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintAdaptiveSizePolicy&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles&#x3D;5 -XX:GCLogFileSize&#x3D;30m&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:-OmitStackTraceInFastThrow&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:+AlwaysPreTouch&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:MaxDirectMemorySize&#x3D;20g&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:-UseLargePages -XX:-UseBiasedLocking&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -Djava.ext.dirs&#x3D;$&#123;JAVA_HOME&#125;&#x2F;jre&#x2F;lib&#x2F;ext:$&#123;BASE_DIR&#125;&#x2F;lib&quot;#JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -Xdebug -Xrunjdwp:transport&#x3D;dt_socket,address&#x3D;9555,server&#x3D;y,suspend&#x3D;n&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; $&#123;JAVA_OPT_EXT&#125;&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -cp $&#123;CLASSPATH&#125;&quot;numactl --interleave&#x3D;all pwd &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1if [ $? -eq 0 ]thenif [ -z &quot;$RMQ_NUMA_NODE&quot; ] ; thennumactl --interleave&#x3D;all $JAVA $&#123;JAVA_OPT&#125; $@elsenumactl --cpunodebind&#x3D;$RMQ_NUMA_NODE --membind&#x3D;$RMQ_NUMA_NODE $JAVA $&#123;JAVA_OPT&#125; $@fielse$JAVA $&#123;JAVA_OPT&#125; $@fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ¶ä½œ<code>systemd</code>è„šæœ¬ï¼šbroker.service</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;broker.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[Unit]Description&#x3D;RocketMQ-BrokerAfter&#x3D;namesrv.service[Service]ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-rocketmq&#x2F;bin&#x2F;mqbroker -c &#x2F;usr&#x2F;local&#x2F;apache-rocketmq&#x2F;conf&#x2F;product&#x2F;broker-a-master.propertiesExecStop&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-rocketmq&#x2F;bin&#x2F;mqshutdown broker[Install]WantedBy&#x3D;multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ ln -s &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;broker.service &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;broker.servicejobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ systemctl daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨**<em>broker**</em></li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ systemctl start broker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="Slave"><a href="#Slave" class="headerlink" title="Slave"></a>Slave</h5><ul><li>åœ¨<code>10.100.1.23</code>ä¸Šæ–°å»º<code>broker-a-slave.properties</code>æ–‡ä»¶ï¼š</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local$ mkdir apache-rocketmq&#x2F;conf&#x2F;productjobshen@JobShen-PC:&#x2F;usr&#x2F;local$ vim apache-rocketmq&#x2F;conf&#x2F;product&#x2F;broker-a-slave.properties<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">rocketmqHome</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/apache-rocketmq</span><span class="token attr-name">namesrvAddr</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.23:9876;10.100.1.24:9876</span><span class="token attr-name">brokerIP1</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.23</span><span class="token attr-name">brokerIP2</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.23</span><span class="token attr-name">brokerName</span><span class="token punctuation">=</span><span class="token attr-value">mq_a</span><span class="token attr-name">brokerClusterName</span><span class="token punctuation">=</span><span class="token attr-value">ProductCluster</span><span class="token attr-name">brokerId</span><span class="token punctuation">=</span><span class="token attr-value">1</span><span class="token attr-name">defaultTopicQueueNums</span><span class="token punctuation">=</span><span class="token attr-value">16</span><span class="token attr-name">autoCreateTopicEnable</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token attr-name">clusterTopicEnable</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">brokerTopicEnable</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">autoCreateSubscriptionGroup</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">listenPort</span><span class="token punctuation">=</span><span class="token attr-value">10911</span><span class="token attr-name">storePathRootDir</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/rocketmq_data/store</span><span class="token attr-name">storePathCommitLog</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/rocketmq_data/store/commitlog/</span><span class="token attr-name">storePathConsumerQueue</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/rocketmq_data/store/consumequeue/</span><span class="token attr-name">mapedFileSizeCommitLog</span><span class="token punctuation">=</span><span class="token attr-value">1073741824</span><span class="token attr-name">mapedFileSizeConsumeQueue</span><span class="token punctuation">=</span><span class="token attr-value">6000000</span><span class="token attr-name">deleteWhen</span><span class="token punctuation">=</span><span class="token attr-value">04</span><span class="token attr-name">diskMaxUsedSpaceRatio</span><span class="token punctuation">=</span><span class="token attr-value">75</span><span class="token attr-name">fileReserverdTime</span><span class="token punctuation">=</span><span class="token attr-value">72</span><span class="token attr-name">haListenPort</span><span class="token punctuation">=</span><span class="token attr-value">10912</span><span class="token attr-name">haSendHeartbeatInterval</span><span class="token punctuation">=</span><span class="token attr-value">5000</span><span class="token attr-name">haHousekeepingInterval</span><span class="token punctuation">=</span><span class="token attr-value">20000</span><span class="token attr-name">haTransferBatchSize</span><span class="token punctuation">=</span><span class="token attr-value">32768</span><span class="token attr-name">haMasterAddress</span><span class="token punctuation">=</span><span class="token attr-name">haSlaveFallbehindMax</span><span class="token punctuation">=</span><span class="token attr-value">268435456</span><span class="token attr-name">brokerRole</span><span class="token punctuation">=</span><span class="token attr-value">ASYNC_MASTER</span><span class="token attr-name">flushDiskType</span><span class="token punctuation">=</span><span class="token attr-value">ASYNC_FLUSH</span><span class="token attr-name">syncFlushTimeout</span><span class="token punctuation">=</span><span class="token attr-value">5000</span><span class="token attr-name">messageDelayLevel</span><span class="token punctuation">=</span><span class="token attr-value">1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h</span><span class="token attr-name">flushDelayOffsetInterval</span><span class="token punctuation">=</span><span class="token attr-value">10000</span><span class="token attr-name">cleanFileForciblyEnable</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¿®æ”¹<code>jvm</code>å¯åŠ¨å‚æ•°ï¼š</li></ul><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;local&#x2F;apache-rocketmq$ vim bin&#x2F;runbroker.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#!&#x2F;bin&#x2F;sh# Licensed to the Apache Software Foundation (ASF) under one or more# contributor license agreements.  See the NOTICE file distributed with# this work for additional information regarding copyright ownership.# The ASF licenses this file to You under the Apache License, Version 2.0# (the &quot;License&quot;); you may not use this file except in compliance with# the License.  You may obtain a copy of the License at##     http:&#x2F;&#x2F;www.apache.org&#x2F;licenses&#x2F;LICENSE-2.0## Unless required by applicable law or agreed to in writing, software# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.# See the License for the specific language governing permissions and# limitations under the License.#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;# Java Environment Setting#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;error_exit ()&#123;    echo &quot;ERROR: $1 !!&quot;    exit 1&#125;[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; JAVA_HOME&#x3D;$HOME&#x2F;jdk&#x2F;java[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; JAVA_HOME&#x3D;&#x2F;usr&#x2F;java[ ! -e &quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot; ] &amp;&amp; error_exit &quot;Please set the JAVA_HOME variable in your environment, We need java(x64)!&quot;export JAVA_HOMEexport JAVA&#x3D;&quot;$JAVA_HOME&#x2F;bin&#x2F;java&quot;export BASE_DIR&#x3D;$(dirname $0)&#x2F;..export CLASSPATH&#x3D;.:$&#123;BASE_DIR&#125;&#x2F;conf:$&#123;CLASSPATH&#125;#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;# JVM Configuration#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -server -Xms32g -Xmx32g -Xmn16g&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:+UseG1GC -XX:G1HeapRegionSize&#x3D;32m -XX:G1ReservePercent&#x3D;25 -XX:InitiatingHeapOccupancyPercent&#x3D;30 -XX:SoftRefLRUPolicyMSPerMB&#x3D;0 -XX:SurvivorRatio&#x3D;8&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -verbose:gc -Xloggc:&#x2F;dev&#x2F;shm&#x2F;mq_gc_%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintAdaptiveSizePolicy&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles&#x3D;5 -XX:GCLogFileSize&#x3D;30m&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:-OmitStackTraceInFastThrow&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:+AlwaysPreTouch&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:MaxDirectMemorySize&#x3D;15g&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -XX:-UseLargePages -XX:-UseBiasedLocking&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -Djava.ext.dirs&#x3D;$&#123;JAVA_HOME&#125;&#x2F;jre&#x2F;lib&#x2F;ext:$&#123;BASE_DIR&#125;&#x2F;lib&quot;#JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -Xdebug -Xrunjdwp:transport&#x3D;dt_socket,address&#x3D;9555,server&#x3D;y,suspend&#x3D;n&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; $&#123;JAVA_OPT_EXT&#125;&quot;JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -cp $&#123;CLASSPATH&#125;&quot;numactl --interleave&#x3D;all pwd &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1if [ $? -eq 0 ]thenif [ -z &quot;$RMQ_NUMA_NODE&quot; ] ; thennumactl --interleave&#x3D;all $JAVA $&#123;JAVA_OPT&#125; $@elsenumactl --cpunodebind&#x3D;$RMQ_NUMA_NODE --membind&#x3D;$RMQ_NUMA_NODE $JAVA $&#123;JAVA_OPT&#125; $@fielse$JAVA $&#123;JAVA_OPT&#125; $@fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å’Œ**<em>master**</em>ä¸€æ ·åˆ¶ä½œsystemd æœåŠ¡å¹¶å¯åŠ¨</li></ul><h4 id="éƒ¨ç½²broker-b"><a href="#éƒ¨ç½²broker-b" class="headerlink" title="éƒ¨ç½²broker-b"></a>éƒ¨ç½²broker-b</h4><p>åœ¨<code>10.100.1.22</code>ä¸Šéƒ¨ç½²*<strong>master**<em>ï¼Œåœ¨<code>10.100.1.24</code>ä¸Šéƒ¨ç½²</em></strong>slave*<strong>ï¼Œæ–¹å¼å’Œ**<em>broker-a</em></strong>ä¸€æ ·ï¼Œåªéœ€è¦æ³¨æ„ä¿®æ”¹ipåœ°å€å°±å¯ä»¥äº†ã€‚</p><p>è¿™æ ·ï¼Œåˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒMQçš„éƒ¨ç½²å°±å®Œæˆäº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&amp;emsp;&amp;emsp;æ¥ç€ä¸Šç¯‡æ–‡ç« ï¼Œç°åœ¨å¼€å§‹éƒ¨ç½²RocketMQé›†ç¾¤ï¼Œé‡‡ç”¨çš„éƒ¨ç½²æ–¹æ¡ˆæ˜¯é˜¿é‡Œæ¨èçš„ä¸¤ä¸»ä¸¤ä»å¼‚æ­¥åˆ·ç›˜çš„æ¨¡å¼ï¼Œå› æ­¤å‡†å¤‡äº†å››å°æœåŠ¡å™¨æ¥è¿›è¡ŒMQé›†ç¾¤çš„éƒ¨ç½²ï¼Œä»¥ä¸‹æ˜¯éƒ¨ç½²è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•ï¼Œ&lt;/p&gt;</summary>
    
    
    
    <category term="centos7" scheme="http://blog.jobshen.com/categories/centos7/"/>
    
    
    <category term="jdk" scheme="http://blog.jobshen.com/tags/jdk/"/>
    
    <category term="rocketmq" scheme="http://blog.jobshen.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>Centos 7ä¸‹å¸¸è§ä¸­é—´ä»¶ç¯å¢ƒçš„å®‰è£…ï¼ˆä¸€ï¼‰</title>
    <link href="http://blog.jobshen.com/posts/3011500279.html"/>
    <id>http://blog.jobshen.com/posts/3011500279.html</id>
    <published>2017-12-07T12:54:37.000Z</published>
    <updated>2017-12-07T12:54:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;æœ€è¿‘ç”±äºå…¬å¸è¦åˆ‡æ¢IDCæœºæˆ¿ï¼Œæ–°æœºæˆ¿çš„æœåŠ¡å™¨é›†ç¾¤éœ€è¦é‡æ–°éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œäºæ˜¯åˆè¶ç€è¿™æ¬¡æœºä¼šæŠŠä¸€äº›å¸¸ç”¨çš„ä¸­é—´ä»¶åˆé‡æ–°éƒ¨ç½²äº†ä¸€æ¬¡ï¼Œç‰ˆæœ¬æœ‰æ›´æ–°ï¼Œéƒ¨ç½²æ–¹å¼ä¹Ÿä¼šæœ‰å°å˜åŠ¨ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ä¸€ç³»åˆ—çš„æ–‡æ¡£ã€‚æ•´ä¸ªç³»åˆ—ä¸»è¦æ˜¯javaè¿è¡Œç¯å¢ƒä¸‹çš„ä¸­é—´ä»¶éƒ¨ç½²ï¼Œä¹Ÿå«æœ‰å°‘é‡å…¶ä»–ä¸­é—´ä»¶çš„éƒ¨ç½²ï¼Œåƒ <strong>Redis</strong>ã€ <strong>TiDB</strong> ç­‰ã€‚</p><a id="more"></a><h2 id="JDK-å®‰è£…"><a href="#JDK-å®‰è£…" class="headerlink" title="JDK å®‰è£…"></a>JDK å®‰è£…</h2><p>jdkå½“ç„¶æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä»»ä½•javaç¨‹åºå…è®¸éƒ½ä¸èƒ½è„±ç¦»JVMç¯å¢ƒï¼Œè€Œé€šè¿‡jdkå®‰è£…jvmæ˜¯æœ€å¸¸è§çš„æ–¹å¼ï¼Œç”±äºä¸€äº›åŸå› ï¼Œå…¬å¸åœ¨ç”Ÿäº§ç¯å¢ƒå¹¶æ²¡æœ‰ä½¿ç”¨ <em>open-jdk</em> è€Œæ˜¯ä»ç„¶ä½¿ç”¨äº† <em>oralce-jdk</em> ï¼Œå› æ­¤å°±ä¸èƒ½é€šè¿‡ <code>yum install open-jdk</code>çš„æ–¹å¼æ¥å®‰è£…äº†ï¼Œåªèƒ½é€šè¿‡ä¸‹è½½ <em>rpm</em> æ–‡ä»¶æ¥è¿›è¡Œå®‰è£…ã€‚</p><h3 id="jdkä¸‹è½½"><a href="#jdkä¸‹è½½" class="headerlink" title="jdkä¸‹è½½"></a>jdkä¸‹è½½</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;mnt&#x2F;d&#x2F;download&#x2F;softwares$ wget --no-cookies --no-check-certificate --header &quot;Cookie: gpw_e24&#x3D;http%3A%2F%2Fwww.oracle.com%2F; oraclelicense&#x3D;accept-securebackup-cookie&quot; &quot;http:&#x2F;&#x2F;download.oracle.com&#x2F;otn-pub&#x2F;java&#x2F;jdk&#x2F;8u151-b12&#x2F;e758a0de34e24606bca991d704f6dcbf&#x2F;jdk-8u151-linux-x64.rpm&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;mnt&#x2F;d&#x2F;download&#x2F;softwares$ rpm -ivh jdk-8u151-linux-x64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;mnt&#x2F;d&#x2F;download&#x2F;softwares$ vim &#x2F;etc&#x2F;profile&#x2F;&#x2F; åœ¨æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹export JAVA_HOME&#x3D;&#x2F;usr&#x2F;java&#x2F;latestexport PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATHexport CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar&#x2F;&#x2F; ä¿å­˜ ä½¿å…¶ç”Ÿæ•ˆjobshen@JobShen-PC:&#x2F;mnt&#x2F;d&#x2F;download&#x2F;softwares$ source &#x2F;etc&#x2F;profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Zookeeper-é›†ç¾¤å®‰è£…"><a href="#Zookeeper-é›†ç¾¤å®‰è£…" class="headerlink" title="Zookeeper é›†ç¾¤å®‰è£…"></a>Zookeeper é›†ç¾¤å®‰è£…</h2><h3 id="é›†ç¾¤æœºå™¨ä¿¡æ¯"><a href="#é›†ç¾¤æœºå™¨ä¿¡æ¯" class="headerlink" title="é›†ç¾¤æœºå™¨ä¿¡æ¯"></a>é›†ç¾¤æœºå™¨ä¿¡æ¯</h3><table><thead><tr><th align="center">IP</th><th align="center">Port</th><th align="center">myid</th></tr></thead><tbody><tr><td align="center">10.100.1.11</td><td align="center">2181 2888 3888</td><td align="center">1</td></tr><tr><td align="center">10.100.1.12</td><td align="center">2181 2888 3888</td><td align="center">2</td></tr><tr><td align="center">10.100.1.13</td><td align="center">2181 2888 3888</td><td align="center">3</td></tr><tr><td align="center">10.100.1.14</td><td align="center">2181 2888 3888</td><td align="center">4</td></tr><tr><td align="center">10.100.1.15</td><td align="center">2181 2888 3888</td><td align="center">5</td></tr></tbody></table><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;mnt&#x2F;d&#x2F;download&#x2F;softwares$ curl -O https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;zookeeper&#x2F;stable&#x2F;zookeeper-3.4.10.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="è§£å‹"><a href="#è§£å‹" class="headerlink" title="è§£å‹"></a>è§£å‹</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;mnt&#x2F;d&#x2F;download&#x2F;softwares$ tar -zxf zookeeper-3.4.10.tar.gz -C &#x2F;usr&#x2F;localjobshen@JobShen-PC:&#x2F;usr&#x2F;lcoal$ mkdir -p zk_data&#x2F;zookeeper zk_data&#x2F;zoo-logs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="æ–°å»ºzoo-cfg"><a href="#æ–°å»ºzoo-cfg" class="headerlink" title="æ–°å»ºzoo.cfg"></a>æ–°å»ºzoo.cfg</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@JobShen-PC:&#x2F;usr&#x2F;lcoal$ vim zookeeper-3.4.10&#x2F;conf&#x2F;zoo.cfg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">tickTime</span><span class="token punctuation">=</span><span class="token attr-value">2000</span><span class="token attr-name">initLimit</span><span class="token punctuation">=</span><span class="token attr-value">20</span><span class="token attr-name">syncLimit</span><span class="token punctuation">=</span><span class="token attr-value">10</span><span class="token attr-name">dataDir</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zk_data/zookeeper</span><span class="token attr-name">dataLogDir</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zk_data/zoo-logs</span><span class="token attr-name">clientPort</span><span class="token punctuation">=</span><span class="token attr-value">2181</span><span class="token attr-name">server.1</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.11:2888:3888</span><span class="token attr-name">server.2</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.12:2888:3888</span><span class="token attr-name">server.3</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.13:2888:3888</span><span class="token attr-name">server.4</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.14:2888:3888</span><span class="token attr-name">server.5</span><span class="token punctuation">=</span><span class="token attr-value">10.100.1.15:2888:3888</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ–°å»ºmyid"><a href="#æ–°å»ºmyid" class="headerlink" title="æ–°å»ºmyid"></a>æ–°å»ºmyid</h3><p>åˆ†åˆ«åœ¨å„å°æœºå™¨ä¸Šï¼Œæ–°å»ºå¯¹äº<em>myid</em>å€¼çš„<code>myid</code>æ–‡ä»¶</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@10.100.1.11:&#x2F;usr&#x2F;lcoal$ echo &quot;1&quot; &gt; &#x2F;usr&#x2F;local&#x2F;zk_data&#x2F;zookeeper&#x2F;myidjobshen@10.100.1.12:&#x2F;usr&#x2F;lcoal$ echo &quot;2&quot; &gt; &#x2F;usr&#x2F;local&#x2F;zk_data&#x2F;zookeeper&#x2F;myidjobshen@10.100.1.13:&#x2F;usr&#x2F;lcoal$ echo &quot;3&quot; &gt; &#x2F;usr&#x2F;local&#x2F;zk_data&#x2F;zookeeper&#x2F;myidjobshen@10.100.1.14:&#x2F;usr&#x2F;lcoal$ echo &quot;4&quot; &gt; &#x2F;usr&#x2F;local&#x2F;zk_data&#x2F;zookeeper&#x2F;myidjobshen@10.100.1.15:&#x2F;usr&#x2F;lcoal$ echo &quot;5&quot; &gt; &#x2F;usr&#x2F;local&#x2F;zk_data&#x2F;zookeeper&#x2F;myid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ¶ä½œSystemdè„šæœ¬"><a href="#åˆ¶ä½œSystemdè„šæœ¬" class="headerlink" title="åˆ¶ä½œSystemdè„šæœ¬"></a>åˆ¶ä½œSystemdè„šæœ¬</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@10.100.1.11:&#x2F;usr&#x2F;lcoal$ vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;zookeeper.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">[Unit]<span class="token attr-name">Description</span><span class="token punctuation">=</span><span class="token attr-value">zookeeper</span><span class="token attr-name">After</span><span class="token punctuation">=</span><span class="token attr-value">network.target</span>[Service]<span class="token attr-name">Environment</span><span class="token punctuation">=</span><span class="token attr-value">JAVA_HOME=/usr/java/default</span><span class="token attr-name">PIDFile</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zk_data/zookeeper/zookeeper_server.pid</span><span class="token attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zookeeper-3.4.10/bin/zkServer.sh start</span><span class="token attr-name">ExecStop</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zookeeper-3.4.10/bin/zkServer.sh stop</span>[Install]<span class="token attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token attr-value">multi-user.target</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@10.100.1.11:&#x2F;usr&#x2F;lcoal$ ln -s &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;zookeeper.service &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;zookeeper.servicejobshen@10.100.1.11:&#x2F;usr&#x2F;lcoal$ systemctl daemon-reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å¯åŠ¨zké›†ç¾¤"><a href="#å¯åŠ¨zké›†ç¾¤" class="headerlink" title="å¯åŠ¨zké›†ç¾¤"></a>å¯åŠ¨zké›†ç¾¤</h3><p>åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šåˆ†åˆ«å¯åŠ¨zkï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@10.100.1.11:&#x2F;usr&#x2F;lcoal$ systemctl start zookeeper<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ£€æŸ¥zkæ˜¯å¦å¯åŠ¨æˆåŠŸ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jobshen@10.100.1.11:&#x2F;usr&#x2F;lcoal$ cd zookeeper-3.4.10&#x2F;binjobshen@10.100.1.11:&#x2F;usr&#x2F;lcoal&#x2F;zookeeper-3.4.10&#x2F;bin$ .&#x2F;zkServer.sh status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¾“å‡ºä»¥ä¸‹å†…å®¹å³ä»£è¡¨å¯åŠ¨æˆåŠŸï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ZooKeeper JMX enabled by defaultUsing config: &#x2F;usr&#x2F;local&#x2F;zookeeper-3.4.10&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfgMode: follower(master)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸‹ç¯‡æ–‡ç« å°†ç»§ç»­ä»‹ç» <em>RocketMQ</em>ã€ <em>Redis</em> ç­‰é›†ç¾¤çš„å®‰è£…</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&amp;emsp;&amp;emsp;æœ€è¿‘ç”±äºå…¬å¸è¦åˆ‡æ¢IDCæœºæˆ¿ï¼Œæ–°æœºæˆ¿çš„æœåŠ¡å™¨é›†ç¾¤éœ€è¦é‡æ–°éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œäºæ˜¯åˆè¶ç€è¿™æ¬¡æœºä¼šæŠŠä¸€äº›å¸¸ç”¨çš„ä¸­é—´ä»¶åˆé‡æ–°éƒ¨ç½²äº†ä¸€æ¬¡ï¼Œç‰ˆæœ¬æœ‰æ›´æ–°ï¼Œéƒ¨ç½²æ–¹å¼ä¹Ÿä¼šæœ‰å°å˜åŠ¨ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ä¸€ç³»åˆ—çš„æ–‡æ¡£ã€‚æ•´ä¸ªç³»åˆ—ä¸»è¦æ˜¯javaè¿è¡Œç¯å¢ƒä¸‹çš„ä¸­é—´ä»¶éƒ¨ç½²ï¼Œä¹Ÿå«æœ‰å°‘é‡å…¶ä»–ä¸­é—´ä»¶çš„éƒ¨ç½²ï¼Œåƒ &lt;strong&gt;Redis&lt;/strong&gt;ã€ &lt;strong&gt;TiDB&lt;/strong&gt; ç­‰ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="centos7" scheme="http://blog.jobshen.com/categories/centos7/"/>
    
    
    <category term="Centos" scheme="http://blog.jobshen.com/tags/Centos/"/>
    
    <category term="jdk" scheme="http://blog.jobshen.com/tags/jdk/"/>
    
    <category term="zookeeper" scheme="http://blog.jobshen.com/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡çº¿ä¸ŠRedisæ•…éšœæ¢å¤å’Œåˆ†æï¼ˆäºŒï¼‰</title>
    <link href="http://blog.jobshen.com/posts/1461710894.html"/>
    <id>http://blog.jobshen.com/posts/1461710894.html</id>
    <published>2017-09-21T12:08:56.000Z</published>
    <updated>2017-09-21T12:08:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼‚å¸¸åœºæ™¯"><a href="#å¼‚å¸¸åœºæ™¯" class="headerlink" title="å¼‚å¸¸åœºæ™¯"></a>å¼‚å¸¸åœºæ™¯</h2><p>&emsp;&emsp;æœ€è¿‘ä¸€æ®µæ—¶é—´æ—¶ä¸æ—¶å°±æœ‰å¼€å‘äººå‘˜å‘æˆ‘ååº”ï¼šredisçš„keyæœ‰ç‚¹é—®é¢˜ï¼Œå¸®æˆ‘åˆ ä¸ªkeyå€¼ã€æ€ä¹ˆkeyæ²¡æœ‰è¿‡æœŸï¼Œæˆ‘æ˜æ˜è®¾äº†è¿‡æœŸæ—¶é—´çš„ã€‚ä¸€å¼€å§‹æ²¡æœ‰æ”¾å¿ƒä¸Šï¼Œä»¥ä¸ºåªæ˜¯ç¨‹åºé€»è¾‘å¤„ç†ä¸å½“æˆ–è€…rediså¶å°”æŠ½é£ï¼Œä¸ç”¨åœ¨æ„ã€‚å¯æ˜¯æ¸æ¸ååº”çš„äººå¤šäº†ï¼Œè§‰å¾—å¯èƒ½ä¸æ˜¯è¿™ä¹ˆç®€å•äº†ï¼Œäºæ˜¯å°±å’Œç›¸å…³çš„å¼€å‘äººå‘˜è®¨è®ºäº†ä¸‹ï¼Œå‘ç°ä¼šå‡ºç°å¼‚å¸¸çš„åŸºæœ¬æ˜¯ä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š</p><a id="more"></a><ul><li><p>ä½¿ç”¨redis çš„ <strong>incrBy</strong> å‘½ä»¤æ¥é˜²æ­¢é‡å¤æäº¤ï¼Œå¤§è‡´çš„redisäº¤äº’å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&gt; incrBy key 1 # è¿”å› 1 è¡¨ç¤ºæ­£å¸¸ è¿”å› &gt; 1  è¡¨ç¤ºé‡å¤æäº¤ ç›´æ¥ return&gt; expire key 5 # 5ç§’åè¿‡æœŸ&gt; del key # æ­£å¸¸ä¸šåŠ¡é€»è¾‘èµ°å®Œå æ˜¾ç¤ºåˆ é™¤key<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>ä½¿ç”¨ redis ï¼ˆ<strong>set</strong>  <strong>setnx</strong> <strong>setex **ï¼‰ +  **expire</strong> ç»„åˆå‘½ä»¤ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&gt; set |setnx | setex key&gt; expire key seconds # è®¾ç½®å¤±è´¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><p>  ç”±äºç³»ç»Ÿä¸­å¤§é‡ä½¿ç”¨äº†ç¬¬ä¸€ç§æ–¹å¼æ¥é˜²æ­¢é‡å¤æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å¯¹ä¸šåŠ¡å½±å“è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œrediså…·ä½“ç°è±¡ä¸ºï¼š</p><ul><li>è®¾ç½®incrby ç¬¬ä¸€æ¬¡åº”è¯¥è¿”å› <strong>1</strong> </li><li>å®é™…ä¸Šå´è¿”å›äº† <strong>2</strong> ï¼Œå¯¼è‡´ä¸šåŠ¡æµç¨‹æ— æ³•èµ°å®Œï¼Œå¹¶ä¸”keyæ²¡æœ‰åˆ é™¤ä¹Ÿæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´</li></ul><h2 id="æŸ¥æ‰¾é—®é¢˜"><a href="#æŸ¥æ‰¾é—®é¢˜" class="headerlink" title="æŸ¥æ‰¾é—®é¢˜"></a>æŸ¥æ‰¾é—®é¢˜</h2><h3 id="ç¼–å†™æµ‹è¯•ç¨‹åº"><a href="#ç¼–å†™æµ‹è¯•ç¨‹åº" class="headerlink" title="ç¼–å†™æµ‹è¯•ç¨‹åº"></a>ç¼–å†™æµ‹è¯•ç¨‹åº</h3><p>ä¸ºäº†æ’æŸ¥é—®é¢˜å†™äº†ä¸€ä¸ªç®€å•çš„å°ç¨‹åºï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayListWithCapacity</span><span class="token punctuation">(</span><span class="token number">5000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Long</span> first_id <span class="token operator">=</span> <span class="token number">500000000000000001L</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>first_id<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> allDone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// incrby</span>    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>        <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token function">testIncrby</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token punctuation">&#125;</span>                allDone<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>        <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token function">testIncrByAndDel</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token punctuation">&#125;</span>                allDone<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    allDone<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"finish method test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelAndTTL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayListWithCapacity</span><span class="token punctuation">(</span><span class="token number">5000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Long</span> first_id <span class="token operator">=</span> <span class="token number">500000000000000001L</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>first_id<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> allDone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>        <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">testDelAndTTL</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">"walletMember"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                allDone<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"finish walletMember keys"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>        <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">testDelAndTTL</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">"walletMember1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                allDone<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"finish walletMember1 keys"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    allDone<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"finish all keys"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">testIncrby</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">long</span> times <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        times <span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> key <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> value <span class="token operator">=</span> redisOperator<span class="token punctuation">.</span><span class="token function">incrBy</span><span class="token punctuation">(</span><span class="token string">"walletMember"</span> <span class="token operator">+</span> key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1L</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"there is something wrong in &#123;&#125;: the incrBy method return wrong value, expact : &#123;&#125; , result : &#123;&#125;, key : &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"testIncrby"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"walletMember"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"there is something wrong in &#123;&#125;: the incrBy method return wrong value, expact : &#123;&#125; , result : &#123;&#125;, key : &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"testIncrby"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"walletMember"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> isSuccess <span class="token operator">=</span> redisOperator<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"walletMember"</span> <span class="token operator">+</span> key<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSuccess<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>isSuccess<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"there is something wrong in &#123;&#125;: the expire method return wrong value, expact : &#123;&#125; , result : &#123;&#125;, key : &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"testIncrby"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>isSuccess<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> isSuccess<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"walletMember"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"finish &#123;&#125; method &#123;&#125; times. sleep 35 seconds"</span><span class="token punctuation">,</span> <span class="token string">"testIncrby"</span><span class="token punctuation">,</span> times<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>times <span class="token operator">></span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">testIncrByAndDel</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">long</span> times <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        times <span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> key <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> value <span class="token operator">=</span> redisOperator<span class="token punctuation">.</span><span class="token function">incrBy</span><span class="token punctuation">(</span><span class="token string">"walletMember1"</span><span class="token operator">+</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1L</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"there is something wrong in &#123;&#125; method: the incrBy method return wrong value, expact : &#123;&#125; , result : &#123;&#125;, key : &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"testIncrByAndDel"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"walletMember1"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"there is something wrong in &#123;&#125; method: the incrBy method return wrong value, expact : &#123;&#125; , result : &#123;&#125;, key : &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"testIncrByAndDel"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"walletMember1"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> isSuccess<span class="token operator">=</span> redisOperator<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"walletMember"</span><span class="token operator">+</span>key<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isSuccess<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>isSuccess<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"there is something wrong in &#123;&#125;: the expire method return wrong value, expact : &#123;&#125; , result : &#123;&#125;, key : &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"testIncrByAndDel"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>isSuccess<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> isSuccess<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"walletMember1"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            redisOperator<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">"walletMember1"</span><span class="token operator">+</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"finish &#123;&#125; method &#123;&#125; times. sleep 35 seconds"</span><span class="token punctuation">,</span> <span class="token string">"testIncrByAndDel"</span><span class="token punctuation">,</span> times<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>times <span class="token operator">></span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">testDelAndTTL</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> list<span class="token punctuation">,</span> <span class="token class-name">String</span> prefix<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> key <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> value <span class="token operator">=</span> redisOperator<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> key<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Long</span> ttl <span class="token operator">=</span> redisOperator<span class="token punctuation">.</span><span class="token function">getFastJsonRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getExpire</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"there is something wrong : key : &#123;&#125;, value : &#123;&#125;, ttl : &#123;&#125;"</span><span class="token punctuation">,</span> prefix <span class="token operator">+</span> key<span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ttl<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯èƒ½æ˜¯æµ‹è¯•ç”¨ä¾‹å†™çš„ä¸å¥½ï¼Œçº¿ä¸Šçº¿ä¸‹éƒ½æ²¡æœ‰å‘ç°æ˜æ˜¾çš„é—®é¢˜ï¼Œäºæ˜¯å¯¹ä»£ç åšäº†è°ƒæ•´ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayListWithCapacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/test/redis"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">createGoogleAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> numThreads <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>numThreads<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"--------------start------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            threadPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">redis_incrby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token string">"OK"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">redis_incrby</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> loops <span class="token operator">=</span> <span class="token number">2500</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> key <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        keys<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>loops<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, return : &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, expire : &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, return : &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, expire : &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, return : &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, expire : &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, return : &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, expire : &#123;&#125;"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key : &#123;&#125;, finish."</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œå‡ æ¬¡åç»ˆäºå‘ç°äº†é—®é¢˜ï¼šæŒ‰ç…§ä»£ç é€»è¾‘ï¼Œæ¯ä¸ª<strong>key</strong>æœ€åçš„<strong>value</strong>åº”è¯¥éƒ½ä¸º<strong>10000</strong>ï¼Œç„¶åæœ‰çš„keyçš„ç»“æœå¤§äº10000ï¼Œäºæ˜¯æƒ³åˆ°ä¸¤ç§æƒ…å†µï¼š</p><ul><li>1ï¼‰å®¢æˆ·ç«¯å¤šå‘é€äº†ä¸€æ¬¡å‘½ä»¤</li><li>2ï¼‰redis æ‰§è¡Œé”™è¯¯</li></ul><h3 id="éªŒè¯åŸå› "><a href="#éªŒè¯åŸå› " class="headerlink" title="éªŒè¯åŸå› "></a>éªŒè¯åŸå› </h3><p>ä¸ºäº†éªŒè¯åˆ°åº•æ˜¯å“ªç§åŸå› ï¼Œé‡‡å–äº†ä»¥ä¸‹æ–¹å¼ï¼š</p><ul><li><p>ä¿®æ”¹Jedis æºç ï¼šä¿®æ”¹<strong>BinaryClient</strong>çš„<strong>incrBy</strong>æ–¹æ³•ï¼Œæ‰“å°æ—¥å¿—ä¿¡æ¯ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">incrBy</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">long</span> integer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"key: &#123;&#125;, delta : &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">sendCommand</span><span class="token punctuation">(</span>INCRBY<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token function">toByteArray</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹redisè¿›è¡Œç›‘å¬ï¼Œä½¿ç”¨<strong>watch</strong>å‘½ä»¤ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">.&#x2F;redis-cli -c -h ip -p port watch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>é€šè¿‡<strong>tcpdump</strong> å¯¹æ‰€æœ‰æµé‡è®°å½•è¿›è¡Œä¿å­˜</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tcpdump -i eth0 -s 0 -w tcp.cap # ä¿å­˜ä¸º.capæ–‡ä»¶å¯ä»¥é€šè¿‡wireshark è¿›è¡Œåˆ†æ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="åˆ†æåŸå› "><a href="#åˆ†æåŸå› " class="headerlink" title="åˆ†æåŸå› "></a>åˆ†æåŸå› </h3><p>é€šè¿‡é‡æ–°æ‰§è¡Œä¸Šé¢çš„æµ‹è¯•ä»£ç ï¼Œå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œç­›é€‰ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">grep 10001 nohup.out<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»ä¸­é€‰å–ä¸€ä¸ªkeyï¼š<strong>3e9dd73a-fee2-416c-b3c8-5369b2cd4ec8</strong></p><p>ç„¶åç»§ç»­ç­›é€‰ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">grep &quot;key : 3e9dd73a-fee2-416c-b3c8-5369b2cd4ec8 return : &quot; nohup.out<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»”ç»†æŸ¥çœ‹åå‘ç°ï¼š</p><p><img data-src="https://picture.jobshen.com/blog/redis/redis-03.png" alt="valueè·³è·ƒ"></p><p>ç›´æ¥ä» <strong>2698</strong> è·³è·ƒåˆ°äº† <strong>2700</strong></p><p>ç„¶åå†ç­›é€‰æ—¥å¿—ï¼Œå‘ç°ä»¥ä¸‹å†…å®¹ï¼š</p><p><img data-src="https://picture.jobshen.com/blog/redis/redis-04.png" alt="é‡å¤"></p><p>è¿ç»­æ‰§è¡Œäº†ä¸¤æ¬¡<strong>incrBy</strong>å‘½ä»¤ï¼Œç„¶åå†å»æŸ¥æ‰¾åŒä¸€æ—¶åˆ»çš„redis watchè®°å½•ï¼Œå‘ç°çš„ç¡®æ”¶åˆ°äº†ä¸¤æ¡<strong>INCRBY  3e9dd73a-fee2-416c-b3c8-5369b2cd4ec8 1</strong>å‘½ä»¤ï¼Œé‚£æ¥ä¸‹æ¥å°±è¦ææ¸…æ¥šä¸ºä»€ä¹ˆä¼šå‘èµ·ä¸¤æ¬¡è¯·æ±‚ï¼Œäºæ˜¯è½®åˆ°tcpdumpäº†ã€‚</p><h3 id="wireshark-åˆ†æè¯·æ±‚æµé‡"><a href="#wireshark-åˆ†æè¯·æ±‚æµé‡" class="headerlink" title="wireshark åˆ†æè¯·æ±‚æµé‡"></a>wireshark åˆ†æè¯·æ±‚æµé‡</h3><p>å°†tcpdumpçš„æ–‡ä»¶å¯¼å…¥wiresharkåï¼Œæ ¹æ®ç­›é€‰æ¡ä»¶è¿›è¡Œç­›é€‰ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†å¯¹åº”çš„tcpè¯·æ±‚ï¼ˆFrame 698961ï¼‰ï¼š</p><p><img data-src="https://picture.jobshen.com/blog/redis/redis-05.png" alt="wireshark"></p><p>å…¶ä¸­è¿™è¡Œå¼•èµ·äº†æˆ‘æ³¨æ„ï¼š**[Expert Info (Note/Sequence): This frame is a (suspected) retransmission]**</p><p>æŸ¥è¯¢èµ„æ–™åå‘ç°ï¼Œè¿™ç§æƒ…å†µæ˜¯å‡ºç°åœ¨ä»¥ä¸‹æƒ…å½¢ï¼š</p><p>â€‹    å½“tcpè¯·æ±‚å…è®¸é‡è¯•çš„å‰æä¸‹å‘ç°å½“å‰tcpè¯·æ±‚è¿‡äº†<strong>timeout</strong>æ—¶é—´è¿˜æ²¡æ”¶åˆ°è¿”å›å€¼ï¼Œé‚£ä¹ˆå°±å‘èµ·ä¸€æ¬¡é‡è¯•ï¼Œè€Œé‡è¯•çš„tcpè¯·æ±‚åœ¨wiresharkä¸­å°±ä¼šè¢«æ ‡è®°ä¸º**[Expert Info (Note/Sequence): This frame is a (suspected) retransmission]**ã€‚</p><p>äºæ˜¯åŸå› å¾ˆæ˜æ˜¾äº†ï¼Œç”±äºJedisè®¾ç½®çš„è¶…æ—¶æ—¶é—´è¿‡çŸ­ï¼Œå¯¼è‡´jediså‘èµ·äº†é‡è¯•ï¼Œæœ€ç»ˆå¯¼è‡´äº†ä¸Šè¿°redisçš„å¼‚å¸¸æƒ…å†µã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h3><p>æŸ¥è¯¢jedisé…ç½®æ–‡ä»¶ï¼Œå‘ç°è¶…æ—¶æ—¶é—´ä¸º500æ¯«ç§’ï¼Œ</p><p><img data-src="https://picture.jobshen.com/blog/redis/redis-06.png" alt="jedis"></p><p>æ˜¾ç„¶å¤ªçŸ­äº†ï¼Œé‚æ”¹ä¸º15ç§’ï¼Œæ”¹å®Œä»¥ä¸‹é‡æ–°æ‰§è¡Œäº†å‡ æ¬¡æµ‹è¯•ç¨‹åºï¼Œéƒ½æ²¡æœ‰å†å‘ç°é—®é¢˜ï¼Œç„¶åä¿®æ”¹çº¿ä¸Šä»£ç ã€‚</p><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>å¯¼è‡´ä¸Šè¿°jedisè¯·æ±‚è¶…æ—¶çš„åŸå› ä¹Ÿæœ‰redis clusterçš„åŸå› ã€‚æŸ¥è¯¢å‘ç°çº¿ä¸Šé›†ç¾¤å­˜åœ¨è¿™keyåˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µï¼š</p><p><img data-src="https://picture.jobshen.com/blog/redis/redis-07.png" alt="redis-key"></p><p>å¯ä»¥çœ‹å‡ºå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„keyæ•°é‡æ˜¯å…¶ä»–èŠ‚ç‚¹çš„1.5å€ï¼Œå¹¶ä¸”åˆ†æè¿™äº›keyå‘ç°ä»–ä»¬è®¿é—®çš„é¢‘ç‡ä¹Ÿå¾ˆé«˜ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¼è‡´äº†jedisçš„è¶…æ—¶ï¼Œå› æ­¤æ¥ä¸‹æ¥è¦å¯¹redisé›†ç¾¤è¿›è¡Œä¼˜åŒ–ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å¼‚å¸¸åœºæ™¯&quot;&gt;&lt;a href=&quot;#å¼‚å¸¸åœºæ™¯&quot; class=&quot;headerlink&quot; title=&quot;å¼‚å¸¸åœºæ™¯&quot;&gt;&lt;/a&gt;å¼‚å¸¸åœºæ™¯&lt;/h2&gt;&lt;p&gt;&amp;emsp;&amp;emsp;æœ€è¿‘ä¸€æ®µæ—¶é—´æ—¶ä¸æ—¶å°±æœ‰å¼€å‘äººå‘˜å‘æˆ‘ååº”ï¼šredisçš„keyæœ‰ç‚¹é—®é¢˜ï¼Œå¸®æˆ‘åˆ ä¸ªkeyå€¼ã€æ€ä¹ˆkeyæ²¡æœ‰è¿‡æœŸï¼Œæˆ‘æ˜æ˜è®¾äº†è¿‡æœŸæ—¶é—´çš„ã€‚ä¸€å¼€å§‹æ²¡æœ‰æ”¾å¿ƒä¸Šï¼Œä»¥ä¸ºåªæ˜¯ç¨‹åºé€»è¾‘å¤„ç†ä¸å½“æˆ–è€…rediså¶å°”æŠ½é£ï¼Œä¸ç”¨åœ¨æ„ã€‚å¯æ˜¯æ¸æ¸ååº”çš„äººå¤šäº†ï¼Œè§‰å¾—å¯èƒ½ä¸æ˜¯è¿™ä¹ˆç®€å•äº†ï¼Œäºæ˜¯å°±å’Œç›¸å…³çš„å¼€å‘äººå‘˜è®¨è®ºäº†ä¸‹ï¼Œå‘ç°ä¼šå‡ºç°å¼‚å¸¸çš„åŸºæœ¬æ˜¯ä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼š&lt;/p&gt;</summary>
    
    
    
    <category term="redis" scheme="http://blog.jobshen.com/categories/redis/"/>
    
    
    <category term="Redis" scheme="http://blog.jobshen.com/tags/Redis/"/>
    
    <category term="Redis Cluster" scheme="http://blog.jobshen.com/tags/Redis-Cluster/"/>
    
    <category term="Jedis" scheme="http://blog.jobshen.com/tags/Jedis/"/>
    
    <category term="Wireshark" scheme="http://blog.jobshen.com/tags/Wireshark/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡çº¿ä¸ŠRedisæ•…éšœæ¢å¤å’Œåˆ†æï¼ˆä¸€ï¼‰</title>
    <link href="http://blog.jobshen.com/posts/1728650486.html"/>
    <id>http://blog.jobshen.com/posts/1728650486.html</id>
    <published>2017-09-20T14:37:20.000Z</published>
    <updated>2017-09-20T14:37:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>&emsp;&emsp;é‚£å¤©æ—©ä¸Šä¸€åˆ°å…¬å¸å°±æœ‰å®¢æœè¿‡æ¥ååº”æˆ‘ä»¬çš„Appç™»å½•ä¸äº†äº†ï¼Œæˆ‘èµ¶ç´§è¯•äº†ä¸€ä¸‹ç™»é™†Appï¼Œå‘ç°æ˜¯å¯ä»¥ç™»å½•çš„ï¼Œå°±ä»¥ä¸ºæ˜¯ä¸ªåˆ«ç°è±¡æ²¡æœ‰åœ¨æ„ã€‚è¿‡äº†ä¸€ä¼šå„¿å®¢æœæ¥ååº”æ›´é¢‘ç¹äº†ï¼Œè¿™æ‰æ„è¯†åˆ°å¯èƒ½æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚</p><a id="more"></a><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>&emsp;&emsp;ä¸€å¼€å§‹è®¤ä¸ºæ˜¯æœåŠ¡å™¨é—®é¢˜ï¼Œæ£€æŸ¥äº†æ‰€æœ‰ç›¸å…³çš„åº”ç”¨æœåŠ¡å™¨ï¼Œåº”ç”¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œå‘ç°ä¸€åˆ‡æ­£å¸¸ï¼Œcpuã€å†…å­˜ã€IO éƒ½æ˜¯æ­£å¸¸çš„ï¼Œæ²¡æœ‰å¼‚å¸¸ï¼›</p><p>ç„¶åè€ƒè™‘æ˜¯å¦æ˜¯ä»£ç å±‚é¢é—®é¢˜ï¼ˆæ•°æ®åº“é—®é¢˜è¢«æ’é™¤ï¼Œå› ä¸ºä¸€æ—¦æ•°æ®åº“å‡ºé—®é¢˜ä¸å¯èƒ½åªæœ‰ä¸€éƒ¨åˆ†äººå—å½±å“ï¼‰ï¼Œäºæ˜¯å»æ£€æŸ¥æ—¥å¿—ï¼Œå‘ç°æœ‰ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p><p><img data-src="https://picture.jobshen.com/blog/redis/redis-01.png" alt="é”™è¯¯ä¿¡æ¯"></p><p>ç„¶åç™»é™†redisæ§åˆ¶å°ï¼Œä¸€å°ä¸€å°æµ‹è¯•ï¼Œç»ˆäºå‘ç°äº†æœ‰é—®é¢˜çš„é‚£å°æœºå™¨ï¼š</p><p><img data-src="https://picture.jobshen.com/blog/redis/redis-02.png" alt="å‘ç°é—®é¢˜"></p><p>æ¥ä¸‹æ¥è¦åšçš„å°±å¾ˆç®€å•äº†ï¼Œredisæ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰master-slaveï¼Œå› æ­¤ç›´æ¥killè¯¥èŠ‚ç‚¹ï¼Œé—®é¢˜ä¿®å¤ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p><h2 id="å¯»æ‰¾æ ¹æœ¬åŸå› "><a href="#å¯»æ‰¾æ ¹æœ¬åŸå› " class="headerlink" title="å¯»æ‰¾æ ¹æœ¬åŸå› "></a>å¯»æ‰¾æ ¹æœ¬åŸå› </h2><p>&emsp;&emsp;ä½†æ˜¯è¿™æ ·åšå¹¶ä¸èƒ½è§£å†³æ ¹æœ¬é—®é¢˜ï¼Œç”±äºä¹‹å‰éƒ¨ç½²redisé›†ç¾¤æ—¶è€ƒè™‘ä¸å¤Ÿå‘¨å…¨ï¼Œæ²¡æœ‰é…ç½®redisæ—¥å¿—ï¼Œå› æ­¤å†³å®šç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé€ä¸ªé‡å¯redisèŠ‚ç‚¹ã€‚è¿™ä¹Ÿå°±å¯¼è‡´äº†å†æ¬¡æ•…éšœï¼Œå› ä¸ºé‚£ä¸ªæ•…éšœèŠ‚ç‚¹åˆè¢«å¯åŠ¨åŠ å…¥é›†ç¾¤å¹¶ä¸”ç”±äºæ‰€æœ‰èŠ‚ç‚¹éƒ½ç»å†äº†é‡å¯è¯¥èŠ‚ç‚¹åˆè¢«è®¾ä¸ºmasteräº†ã€‚</p><p>è¿™æ—¶å»è§‚å¯Ÿè¯¥èŠ‚ç‚¹redisçš„æ—¥å¿—ï¼Œç»ˆäºå‘ç°äº†é—®é¢˜ï¼Œæ»¡å±éƒ½æ˜¯å¼‚å¸¸ä¿¡æ¯ï¼š</p><p> <strong>Canâ€™t save in background: fork: Cannot allocate memory</strong>  </p><p>&emsp;&emsp;é€šè¿‡Googleå¾—çŸ¥æ˜¯ç”±äºæœºå™¨å†…å­˜ä¸è¶³å¯¼è‡´çš„ï¼Œé‚æ£€æŸ¥æœºå™¨å†…å­˜ï¼Œå‘ç°å†…å­˜å·²è¢«å ç”¨è¶…è¿‡90%ï¼Œäºæ˜¯èµ¶ç´§å¢å¤§æœºå™¨å†…å­˜ï¼Œæ¯•ç«Ÿredis æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰èƒ½åšåˆ°è¿™ä¹ˆå¿«çš„è¯»å†™ã€‚</p><p>&emsp;&emsp;åŸºäºæ­¤ï¼Œå¯¹æ•´ä¸ªredisé›†ç¾¤çš„å†…å­˜å ç”¨æƒ…å†µè¿›è¡Œäº†ä¸€æ¬¡æ’æŸ¥ï¼Œå¢å¤§äº†æœºå™¨å†…å­˜ï¼Œå¹¶ä¸”å¢åŠ äº†å¯¹æœºå™¨å†…å­˜ä½¿ç”¨æƒ…å†µçš„ç›‘æ§é˜²æ­¢å†å‡ºç°æ­¤ç±»æƒ…å†µã€‚</p><h2 id="åˆä¸€ä¸ªé—®é¢˜"><a href="#åˆä¸€ä¸ªé—®é¢˜" class="headerlink" title="åˆä¸€ä¸ªé—®é¢˜"></a>åˆä¸€ä¸ªé—®é¢˜</h2><p>&emsp;&emsp;å¥½æ™¯ä¸é•¿ï¼Œä¸€ä¸ªé—®é¢˜è§£å†³åˆæ¥ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºredisæ“ä½œå‡ºç°äº†éé¢„æœŸç»“æœï¼Œç±»ä¼¼ incrBy +1 ç»“æœ+2ï¼Œæ‰§è¡Œexpire ç»“æœè¿”å›å¤±è´¥ã€‚</p><p>&emsp;&emsp;è¯¥é—®é¢˜çš„è·Ÿè¸ªè§£å†³å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h2&gt;&lt;p&gt;&amp;emsp;&amp;emsp;é‚£å¤©æ—©ä¸Šä¸€åˆ°å…¬å¸å°±æœ‰å®¢æœè¿‡æ¥ååº”æˆ‘ä»¬çš„Appç™»å½•ä¸äº†äº†ï¼Œæˆ‘èµ¶ç´§è¯•äº†ä¸€ä¸‹ç™»é™†Appï¼Œå‘ç°æ˜¯å¯ä»¥ç™»å½•çš„ï¼Œå°±ä»¥ä¸ºæ˜¯ä¸ªåˆ«ç°è±¡æ²¡æœ‰åœ¨æ„ã€‚è¿‡äº†ä¸€ä¼šå„¿å®¢æœæ¥ååº”æ›´é¢‘ç¹äº†ï¼Œè¿™æ‰æ„è¯†åˆ°å¯èƒ½æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="redis" scheme="http://blog.jobshen.com/categories/redis/"/>
    
    
    <category term="Redis" scheme="http://blog.jobshen.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨Hexoå’ŒGithub Pageæ­å»ºä¸ªäººBlog</title>
    <link href="http://blog.jobshen.com/posts/3873148614.html"/>
    <id>http://blog.jobshen.com/posts/3873148614.html</id>
    <published>2017-09-17T10:44:56.000Z</published>
    <updated>2017-09-17T10:44:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;ä¹‹å‰ä½¿ç”¨wordpressåœ¨AWSä¸Šæ­å»ºçš„åšå®¢ï¼Œä½†å›½å†…è®¿é—®é€Ÿåº¦å ªå¿§ï¼Œè€Œä¸”è´¹ç”¨ä¹Ÿä¸å°‘ï¼Œäºæ˜¯è§‰å¾—åˆ‡åˆ°Githubä¸Šï¼Œæœ€ç»ˆè§‰å¾—é€šè¿‡Hexoå’ŒGithub Pageé‡æ–°æ­å»ºåšå®¢ï¼Œè¿™ç¯‡æ–‡ç« åªæ˜¯ä¸ºäº†è®°å½•æ­å»ºçš„è¿‡ç¨‹ï¼Œä»¥é˜²ä»¥åå¿˜è®°ï¼ˆè®°æ€§ä¸å¥½å•Šã€‚ã€‚ã€‚ï¼‰</p><a id="more"></a><h2 id="æ³¨å†ŒåŸŸåå¹¶ç»‘å®šGithub-Page"><a href="#æ³¨å†ŒåŸŸåå¹¶ç»‘å®šGithub-Page" class="headerlink" title="æ³¨å†ŒåŸŸåå¹¶ç»‘å®šGithub Page"></a>æ³¨å†ŒåŸŸåå¹¶ç»‘å®šGithub Page</h2><p>æ³¨å†ŒGithubå’ŒåŸŸåå°±ä¸å¤šè¯´äº†ï¼Œç½‘ä¸Šä¸€æœä¸€å¤§æ¨ï¼Œæ¥ç€å»Githubæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œåä¸ºä¸ªäººIDåŠ  <strong>github.io</strong>ï¼Œä¾‹å¦‚æˆ‘çš„å°±æ˜¯kitdine.github.io:</p><p><img data-src="https://picture.jobshen.com/blog/hexo_github/snipaste_20170917_185841.png" alt="img"></p><p>ç„¶ååœ¨è¯¥ä»“åº“ä¸‹æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶ <strong>CNAME</strong>ï¼Œ æ‰“å¼€åå°†é‡Œé¢çš„å€¼ä¿®æ”¹ä¸ºä½ åšå®¢çš„åŸŸåï¼Œä¾‹å¦‚æˆ‘çš„ <strong>blog.jobshen.com</strong></p><p><img data-src="https://picture.jobshen.com/blog/hexo_github/snipaste_20170917_191236.png" alt="img"></p><p>æ³¨å†Œå®ŒåŸŸååæ·»åŠ ä¸€æ¡CNAMEè®°å½•ï¼Œç„¶åè§£æåˆ°github Pageçš„åœ°å€ï¼Œæˆ‘çš„åŸŸåæ˜¯åœ¨Godaddyä¸Šæ³¨å†Œï¼Œæ·»åŠ ä¸€ä¸ªCNAMEæŒ‡å‘github.ioï¼Œåƒè¿™æ ·ï¼š</p><p><img data-src="https://picture.jobshen.com/blog/hexo_github/snipaste_20170917_191445.png" alt="img"></p><p>è¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡è‡ªå·±çš„åŸŸåè®¿é—®GitHub Pageäº†ã€‚</p><h2 id="å®‰è£…Hexo"><a href="#å®‰è£…Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h2><p>ä¹‹æ‰€ä»¥é€‰æ‹©Hexoæ˜¯å› ä¸ºHexoçœ‹ä¸Šå»éå¸¸ç®€æ´è€Œä¸”æ”¯æŒMarkdownï¼Œç¬¦åˆæˆ‘çš„æœŸæœ›ï¼Œå®‰è£…ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚</p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>Hexo éœ€è¦NodeJ.jså’Œgit</p><h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><ul><li>Windowsï¼šä¸‹è½½å¹¶å®‰è£… <a href="https://git-scm.com/download/win">git</a>.</li><li>Macï¼šä½¿ç”¨ <a href="http://mxcl.github.com/homebrew/">Homebrew</a>, <a href="http://www.macports.org/">MacPorts</a> ï¼š<code>brew install git</code>;æˆ–ä¸‹è½½ <a href="http://sourceforge.net/projects/git-osx-installer/">å®‰è£…ç¨‹åº</a> å®‰è£…ã€‚</li><li>Linux (Ubuntu, Debian)ï¼š<code>sudo apt-get install git-core</code></li><li>Linux (Fedora, Red Hat, CentOS)ï¼š<code>sudo yum install git-core</code></li></ul><h4 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h4><p>å®‰è£… Node.js çš„æœ€ä½³æ–¹å¼æ˜¯ä½¿ç”¨ <a href="https://github.com/creationix/nvm">nvm</a>ã€‚</p><p>cURL:</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ curl https:&#x2F;&#x2F;raw.github.com&#x2F;creationix&#x2F;nvm&#x2F;master&#x2F;install.sh | sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Wget:</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ wget -qO- https:&#x2F;&#x2F;raw.github.com&#x2F;creationix&#x2F;nvm&#x2F;master&#x2F;install.sh | sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®‰è£…å®Œæˆåï¼Œé‡å¯ç»ˆç«¯å¹¶æ‰§è¡Œä¸‹åˆ—å‘½ä»¤å³å¯å®‰è£… Node.jsã€‚</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ nvm install stable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…æ‚¨ä¹Ÿå¯ä»¥ä¸‹è½½ <a href="http://nodejs.org/">å®‰è£…ç¨‹åº</a> æ¥å®‰è£…ã€‚</p><blockquote><p>Windows ç”¨æˆ·</p><p>å¯¹äºwindowsç”¨æˆ·æ¥è¯´ï¼Œå»ºè®®ä½¿ç”¨å®‰è£…ç¨‹åºè¿›è¡Œå®‰è£…ã€‚å®‰è£…æ—¶ï¼Œè¯·å‹¾é€‰<strong>Add to PATH</strong>é€‰é¡¹ã€‚<br>å¦å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨<strong>Git Bash</strong>ï¼Œè¿™æ˜¯git for windowsè‡ªå¸¦çš„ä¸€ç»„ç¨‹åºï¼Œæä¾›äº†Linuxé£æ ¼çš„shellï¼Œåœ¨è¯¥ç¯å¢ƒä¸‹ï¼Œæ‚¨å¯ä»¥ç›´æ¥ç”¨ä¸Šé¢æåˆ°çš„å‘½ä»¤æ¥å®‰è£…Node.jsã€‚æ‰“å¼€å®ƒçš„æ–¹æ³•å¾ˆç®€å•ï¼Œåœ¨ä»»æ„ä½ç½®å•å‡»å³é”®ï¼Œé€‰æ‹©â€œGit Bash Hereâ€å³å¯ã€‚ç”±äºHexoçš„å¾ˆå¤šæ“ä½œéƒ½æ¶‰åŠåˆ°å‘½ä»¤è¡Œï¼Œæ‚¨å¯ä»¥è€ƒè™‘å§‹ç»ˆä½¿ç”¨<strong>Git Bash</strong>æ¥è¿›è¡Œæ“ä½œã€‚</p></blockquote><h4 id="å®‰è£…Hexo-1"><a href="#å®‰è£…Hexo-1" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h4><p>æ‰€æœ‰å¿…å¤‡çš„åº”ç”¨ç¨‹åºå®‰è£…å®Œæˆåï¼Œå³å¯ä½¿ç”¨ npm å®‰è£… Hexoã€‚</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ npm install -g hexo-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å»ºç«™"><a href="#å»ºç«™" class="headerlink" title="å»ºç«™"></a>å»ºç«™</h2><p>å®‰è£… Hexo å®Œæˆåï¼Œè¯·æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼ŒHexo å°†ä¼šåœ¨æŒ‡å®šæ–‡ä»¶å¤¹ä¸­æ–°å»ºæ‰€éœ€è¦çš„æ–‡ä»¶ã€‚</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ hexo init &lt;folder&gt;$ cd &lt;folder&gt;$ npm install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ–°å»ºå®Œæˆåï¼ŒæŒ‡å®šæ–‡ä»¶å¤¹çš„ç›®å½•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">.â”œâ”€â”€ _config.ymlâ”œâ”€â”€ package.jsonâ”œâ”€â”€ scaffoldsâ”œâ”€â”€ source|   â”œâ”€â”€ _drafts|   â””â”€â”€ _postsâ””â”€â”€ themes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h3><p>ç½‘ç«™çš„ <a href="https://hexo.io/zh-cn/docs/configuration.html">é…ç½®</a> ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤é…ç½®å¤§éƒ¨åˆ†çš„å‚æ•°ã€‚</p><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚<a href="http://embeddedjs.com/">EJS</a>, <a href="http://learnboost.github.io/stylus/">Stylus</a> å’Œ <a href="http://daringfireball.net/projects/markdown/">Markdown</a> renderer å·²é»˜è®¤å®‰è£…ï¼Œæ‚¨å¯ä»¥è‡ªç”±ç§»é™¤ã€‚</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">package.json<span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"hexo-site"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"hexo"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">""</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"hexo"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-archive"</span><span class="token operator">:</span> <span class="token string">"^0.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-category"</span><span class="token operator">:</span> <span class="token string">"^0.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-index"</span><span class="token operator">:</span> <span class="token string">"^0.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-tag"</span><span class="token operator">:</span> <span class="token string">"^0.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-renderer-ejs"</span><span class="token operator">:</span> <span class="token string">"^0.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-renderer-stylus"</span><span class="token operator">:</span> <span class="token string">"^0.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-renderer-marked"</span><span class="token operator">:</span> <span class="token string">"^0.2.4"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-server"</span><span class="token operator">:</span> <span class="token string">"^0.1.2"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="scaffolds"><a href="#scaffolds" class="headerlink" title="scaffolds"></a>scaffolds</h3><p><a href="https://hexo.io/zh-cn/docs/writing.html">æ¨¡ç‰ˆ</a> æ–‡ä»¶å¤¹ã€‚å½“æ‚¨æ–°å»ºæ–‡ç« æ—¶ï¼ŒHexo ä¼šæ ¹æ® scaffold æ¥å»ºç«‹æ–‡ä»¶ã€‚</p><p>Hexoçš„æ¨¡æ¿æ˜¯æŒ‡åœ¨æ–°å»ºçš„markdownæ–‡ä»¶ä¸­é»˜è®¤å¡«å……çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä¿®æ”¹scaffold/post.mdä¸­çš„Front-matterå†…å®¹ï¼Œé‚£ä¹ˆæ¯æ¬¡æ–°å»ºä¸€ç¯‡æ–‡ç« æ—¶éƒ½ä¼šåŒ…å«è¿™ä¸ªä¿®æ”¹ã€‚</p><h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><p>èµ„æºæ–‡ä»¶å¤¹æ˜¯å­˜æ”¾ç”¨æˆ·èµ„æºçš„åœ°æ–¹ã€‚é™¤ <code>_posts</code> æ–‡ä»¶å¤¹ä¹‹å¤–ï¼Œå¼€å¤´å‘½åä¸º <code>_</code> (ä¸‹åˆ’çº¿)çš„æ–‡ä»¶ / æ–‡ä»¶å¤¹å’Œéšè—çš„æ–‡ä»¶å°†ä¼šè¢«å¿½ç•¥ã€‚Markdown å’Œ HTML æ–‡ä»¶ä¼šè¢«è§£æå¹¶æ”¾åˆ° <code>public</code> æ–‡ä»¶å¤¹ï¼Œè€Œå…¶ä»–æ–‡ä»¶ä¼šè¢«æ‹·è´è¿‡å»ã€‚</p><h3 id="themes"><a href="#themes" class="headerlink" title="themes"></a>themes</h3><p><a href="https://hexo.io/zh-cn/docs/themes.html">ä¸»é¢˜</a> æ–‡ä»¶å¤¹ã€‚Hexo ä¼šæ ¹æ®ä¸»é¢˜æ¥ç”Ÿæˆé™æ€é¡µé¢ã€‚</p><h2 id="NexT-ä¸»é¢˜"><a href="#NexT-ä¸»é¢˜" class="headerlink" title="NexT ä¸»é¢˜"></a>NexT ä¸»é¢˜</h2><p>Hexo å®‰è£…ä¸»é¢˜çš„æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦å°†ä¸»é¢˜æ–‡ä»¶æ‹·è´è‡³ç«™ç‚¹ç›®å½•çš„ <code>themes</code> ç›®å½•ä¸‹ï¼Œ ç„¶åä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚å…·ä½“åˆ° NexT æ¥è¯´ï¼Œå®‰è£…æ­¥éª¤å¦‚ä¸‹ã€‚</p><h3 id="ä¸‹è½½ä¸»é¢˜"><a href="#ä¸‹è½½ä¸»é¢˜" class="headerlink" title="ä¸‹è½½ä¸»é¢˜"></a>ä¸‹è½½ä¸»é¢˜</h3><p>å¦‚æœä½ ç†Ÿæ‚‰ <a href="http://git-scm.com/">Git</a>ï¼Œ å»ºè®®ä½ ä½¿ç”¨ å…‹éš†æœ€æ–°ç‰ˆæœ¬ çš„æ–¹å¼ï¼Œä¹‹åçš„æ›´æ–°å¯ä»¥é€šè¿‡ <code>git pull</code> æ¥å¿«é€Ÿæ›´æ–°ï¼Œ è€Œä¸ç”¨å†æ¬¡ä¸‹è½½å‹ç¼©åŒ…æ›¿æ¢ã€‚</p><ul><li>å…‹éš†æœ€æ–°ç‰ˆæœ¬</li></ul><p>åœ¨ç»ˆç«¯çª—å£ä¸‹ï¼Œå®šä½åˆ° Hexo ç«™ç‚¹ç›®å½•ä¸‹ã€‚ä½¿ç”¨ <code>Git</code> checkout ä»£ç ï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ cd your-hexo-site$ git clone https:&#x2F;&#x2F;github.com&#x2F;iissnan&#x2F;hexo-theme-next themes&#x2F;next<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å¯ç”¨ä¸»é¢˜"><a href="#å¯ç”¨ä¸»é¢˜" class="headerlink" title="å¯ç”¨ä¸»é¢˜"></a>å¯ç”¨ä¸»é¢˜</h3><p>ä¸æ‰€æœ‰ Hexo ä¸»é¢˜å¯ç”¨çš„æ¨¡å¼ä¸€æ ·ã€‚ å½“ å…‹éš†/ä¸‹è½½ å®Œæˆåï¼Œæ‰“å¼€ ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œ æ‰¾åˆ° <code>theme</code> å­—æ®µï¼Œå¹¶å°†å…¶å€¼æ›´æ”¹ä¸º <code>next</code>ã€‚</p><p>å¯ç”¨ NexT ä¸»é¢˜</p><pre class="line-numbers language-none"><code class="language-none">theme: next<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ°æ­¤ï¼ŒNexT ä¸»é¢˜å®‰è£…å®Œæˆã€‚ä¸‹ä¸€æ­¥æˆ‘ä»¬å°†éªŒè¯ä¸»é¢˜æ˜¯å¦æ­£ç¡®å¯ç”¨ã€‚åœ¨åˆ‡æ¢ä¸»é¢˜ä¹‹åã€éªŒè¯ä¹‹å‰ï¼Œ æˆ‘ä»¬æœ€å¥½ä½¿ç”¨ <code>hexo clean</code> æ¥æ¸…é™¤ Hexo çš„ç¼“å­˜ã€‚</p><h3 id="éªŒè¯ä¸»é¢˜"><a href="#éªŒè¯ä¸»é¢˜" class="headerlink" title="éªŒè¯ä¸»é¢˜"></a>éªŒè¯ä¸»é¢˜</h3><p>é¦–å…ˆå¯åŠ¨ Hexo æœ¬åœ°ç«™ç‚¹ï¼Œå¹¶å¼€å¯è°ƒè¯•æ¨¡å¼ï¼ˆå³åŠ ä¸Š <code>--debug</code>ï¼‰ï¼Œæ•´ä¸ªå‘½ä»¤æ˜¯ <code>hexo s --debug</code>ã€‚ åœ¨æœåŠ¡å¯åŠ¨çš„è¿‡ç¨‹ï¼Œæ³¨æ„è§‚å¯Ÿå‘½ä»¤è¡Œè¾“å‡ºæ˜¯å¦æœ‰ä»»ä½•å¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚æœä½ ç¢°åˆ°é—®é¢˜ï¼Œè¿™äº›ä¿¡æ¯å°†å¸®åŠ©ä»–äººæ›´å¥½çš„å®šä½é”™è¯¯ã€‚ å½“å‘½ä»¤è¡Œè¾“å‡ºä¸­æç¤ºå‡ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">INFO  Hexo is running at http:&#x2F;&#x2F;localhost:4000&#x2F;. Press Ctrl+C to stop.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶å³å¯ä½¿ç”¨æµè§ˆå™¨è®¿é—® <code>http://localhost:4000</code>ï¼Œæ£€æŸ¥ç«™ç‚¹æ˜¯å¦æ­£ç¡®è¿è¡Œã€‚</p><p>å½“ä½ çœ‹åˆ°ç«™ç‚¹çš„å¤–è§‚ä¸ä¸‹å›¾æ‰€ç¤ºç±»ä¼¼æ—¶å³è¯´æ˜ä½ å·²æˆåŠŸå®‰è£… NexT ä¸»é¢˜ã€‚è¿™æ˜¯ NexT é»˜è®¤çš„ Scheme â€”â€” Muse</p><p><img data-src="https://picture.jobshen.com/blog/hexo_github/validation-default-scheme-mac.png" alt="img"></p><p>ç°åœ¨ï¼Œä½ å·²ç»æˆåŠŸå®‰è£…å¹¶å¯ç”¨äº† NexT ä¸»é¢˜ã€‚ä¸‹ä¸€æ­¥æˆ‘ä»¬å°†è¦æ›´æ”¹ä¸€äº›ä¸»é¢˜çš„è®¾å®šï¼ŒåŒ…æ‹¬ä¸ªæ€§åŒ–ä»¥åŠé›†æˆç¬¬ä¸‰æ–¹æœåŠ¡ã€‚</p><p>æ›´å¤šé…ç½®å¯ä»¥è®¿é—®<a href="http://theme-next.iissnan.com/">NexT</a>è·å–ã€‚</p><h2 id="å†™ä½œ"><a href="#å†™ä½œ" class="headerlink" title="å†™ä½œ"></a>å†™ä½œ</h2><p>ä½ å¯ä»¥æ‰§è¡Œä¸‹åˆ—å‘½ä»¤æ¥åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ hexo new [layout] &lt;title&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‚¨å¯ä»¥åœ¨å‘½ä»¤ä¸­æŒ‡å®šæ–‡ç« çš„å¸ƒå±€ï¼ˆlayoutï¼‰ï¼Œé»˜è®¤ä¸º <code>post</code>ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ <code>_config.yml</code> ä¸­çš„ <code>default_layout</code> å‚æ•°æ¥æŒ‡å®šé»˜è®¤å¸ƒå±€ã€‚</p><h3 id="å¸ƒå±€ï¼ˆLayoutï¼‰"><a href="#å¸ƒå±€ï¼ˆLayoutï¼‰" class="headerlink" title="å¸ƒå±€ï¼ˆLayoutï¼‰"></a>å¸ƒå±€ï¼ˆLayoutï¼‰</h3><p>Hexo æœ‰ä¸‰ç§é»˜è®¤å¸ƒå±€ï¼š<code>post</code>ã€<code>page</code> å’Œ <code>draft</code>ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”ä¸åŒçš„è·¯å¾„ï¼Œè€Œæ‚¨è‡ªå®šä¹‰çš„å…¶ä»–å¸ƒå±€å’Œ <code>post</code> ç›¸åŒï¼Œéƒ½å°†å‚¨å­˜åˆ° <code>source/_posts</code> æ–‡ä»¶å¤¹ã€‚</p><table><thead><tr><th>å¸ƒå±€</th><th>è·¯å¾„</th></tr></thead><tbody><tr><td><code>post</code></td><td><code>source/_posts</code></td></tr><tr><td><code>page</code></td><td><code>source</code></td></tr><tr><td><code>draft</code></td><td><code>source/_drafts</code></td></tr></tbody></table><blockquote><p>ä¸è¦å¤„ç†æˆ‘çš„æ–‡ç« </p><p>å¦‚æœä½ ä¸æƒ³ä½ çš„æ–‡ç« è¢«å¤„ç†ï¼Œä½ å¯ä»¥å°† Front-Matter ä¸­çš„<code>layout:</code> è®¾ä¸º <code>false</code> ã€‚</p></blockquote><h3 id="æ–‡ä»¶åç§°"><a href="#æ–‡ä»¶åç§°" class="headerlink" title="æ–‡ä»¶åç§°"></a>æ–‡ä»¶åç§°</h3><p>Hexo é»˜è®¤ä»¥æ ‡é¢˜åšä¸ºæ–‡ä»¶åç§°ï¼Œä½†æ‚¨å¯ç¼–è¾‘ <code>new_post_name</code> å‚æ•°æ¥æ”¹å˜é»˜è®¤çš„æ–‡ä»¶åç§°ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œè®¾ä¸º <code>:year-:month-:day-:title.md</code> å¯è®©æ‚¨æ›´æ–¹ä¾¿çš„é€šè¿‡æ—¥æœŸæ¥ç®¡ç†æ–‡ç« ã€‚</p><table><thead><tr><th>å˜é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>:title</code></td><td>æ ‡é¢˜ï¼ˆå°å†™ï¼Œç©ºæ ¼å°†ä¼šè¢«æ›¿æ¢ä¸ºçŸ­æ ï¼‰</td></tr><tr><td><code>:year</code></td><td>å»ºç«‹çš„å¹´ä»½ï¼Œæ¯”å¦‚ï¼Œ <code>2015</code></td></tr><tr><td><code>:month</code></td><td>å»ºç«‹çš„æœˆä»½ï¼ˆæœ‰å‰å¯¼é›¶ï¼‰ï¼Œæ¯”å¦‚ï¼Œ <code>04</code></td></tr><tr><td><code>:i_month</code></td><td>å»ºç«‹çš„æœˆä»½ï¼ˆæ— å‰å¯¼é›¶ï¼‰ï¼Œæ¯”å¦‚ï¼Œ <code>4</code></td></tr><tr><td><code>:day</code></td><td>å»ºç«‹çš„æ—¥æœŸï¼ˆæœ‰å‰å¯¼é›¶ï¼‰ï¼Œæ¯”å¦‚ï¼Œ <code>07</code></td></tr><tr><td><code>:i_day</code></td><td>å»ºç«‹çš„æ—¥æœŸï¼ˆæ— å‰å¯¼é›¶ï¼‰ï¼Œæ¯”å¦‚ï¼Œ <code>7</code></td></tr></tbody></table><h3 id="è‰ç¨¿"><a href="#è‰ç¨¿" class="headerlink" title="è‰ç¨¿"></a>è‰ç¨¿</h3><p>åˆšåˆšæåˆ°äº† Hexo çš„ä¸€ç§ç‰¹æ®Šå¸ƒå±€ï¼š<code>draft</code>ï¼Œè¿™ç§å¸ƒå±€åœ¨å»ºç«‹æ—¶ä¼šè¢«ä¿å­˜åˆ° <code>source/_drafts</code> æ–‡ä»¶å¤¹ï¼Œæ‚¨å¯é€šè¿‡ <code>publish</code> å‘½ä»¤å°†è‰ç¨¿ç§»åŠ¨åˆ° <code>source/_posts</code> æ–‡ä»¶å¤¹ï¼Œè¯¥å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼ä¸ <code>new</code> ååˆ†ç±»ä¼¼ï¼Œæ‚¨ä¹Ÿå¯åœ¨å‘½ä»¤ä¸­æŒ‡å®š <code>layout</code> æ¥æŒ‡å®šå¸ƒå±€ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ hexo publish [layout] &lt;title&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è‰ç¨¿é»˜è®¤ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œæ‚¨å¯åœ¨æ‰§è¡Œæ—¶åŠ ä¸Š <code>--draft</code> å‚æ•°ï¼Œæˆ–æ˜¯æŠŠ <code>render_drafts</code> å‚æ•°è®¾ä¸º <code>true</code>æ¥é¢„è§ˆè‰ç¨¿ã€‚</p><h3 id="æ¨¡ç‰ˆï¼ˆScaffoldï¼‰"><a href="#æ¨¡ç‰ˆï¼ˆScaffoldï¼‰" class="headerlink" title="æ¨¡ç‰ˆï¼ˆScaffoldï¼‰"></a>æ¨¡ç‰ˆï¼ˆScaffoldï¼‰</h3><p>åœ¨æ–°å»ºæ–‡ç« æ—¶ï¼ŒHexo ä¼šæ ¹æ® <code>scaffolds</code> æ–‡ä»¶å¤¹å†…ç›¸å¯¹åº”çš„æ–‡ä»¶æ¥å»ºç«‹æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-none"><code class="language-none">$ hexo new photo &quot;My Gallery&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨æ‰§è¡Œè¿™è¡ŒæŒ‡ä»¤æ—¶ï¼ŒHexo ä¼šå°è¯•åœ¨ <code>scaffolds</code> æ–‡ä»¶å¤¹ä¸­å¯»æ‰¾ <code>photo.md</code>ï¼Œå¹¶æ ¹æ®å…¶å†…å®¹å»ºç«‹æ–‡ç« ï¼Œä»¥ä¸‹æ˜¯æ‚¨å¯ä»¥åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨çš„å˜é‡ï¼š</p><table><thead><tr><th>å˜é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>layout</code></td><td>å¸ƒå±€</td></tr><tr><td><code>title</code></td><td>æ ‡é¢˜</td></tr><tr><td><code>date</code></td><td>æ–‡ä»¶å»ºç«‹æ—¥æœŸ</td></tr></tbody></table><h2 id="ç”Ÿæˆæ–‡ä»¶"><a href="#ç”Ÿæˆæ–‡ä»¶" class="headerlink" title="ç”Ÿæˆæ–‡ä»¶"></a>ç”Ÿæˆæ–‡ä»¶</h2><p>ä¿®æ”¹ <code>_config.yml</code> æ–‡ä»¶ï¼š</p><pre class="line-numbers language-none"><code class="language-none"># Directorysource_dir: sourcepublic_dir: path&#x2F;to&#x2F;your&#x2F;github&#x2F;resp # æŒ‡å‘æœ¬åœ°ä»“åº“ï¼Œæ–¹ä¾¿æäº¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ Hexo ç”Ÿæˆé™æ€æ–‡ä»¶å¿«é€Ÿè€Œä¸”ç®€å•ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ç›‘è§†æ–‡ä»¶å˜åŠ¨"><a href="#ç›‘è§†æ–‡ä»¶å˜åŠ¨" class="headerlink" title="ç›‘è§†æ–‡ä»¶å˜åŠ¨"></a>ç›‘è§†æ–‡ä»¶å˜åŠ¨</h3><p>Hexo èƒ½å¤Ÿç›‘è§†æ–‡ä»¶å˜åŠ¨å¹¶ç«‹å³é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œåœ¨ç”Ÿæˆæ—¶ä¼šæ¯”å¯¹æ–‡ä»¶çš„ SHA1 checksumï¼Œåªæœ‰å˜åŠ¨çš„æ–‡ä»¶æ‰ä¼šå†™å…¥ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ hexo generate --watch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;p&gt;&amp;emsp;&amp;emsp;ä¹‹å‰ä½¿ç”¨wordpressåœ¨AWSä¸Šæ­å»ºçš„åšå®¢ï¼Œä½†å›½å†…è®¿é—®é€Ÿåº¦å ªå¿§ï¼Œè€Œä¸”è´¹ç”¨ä¹Ÿä¸å°‘ï¼Œäºæ˜¯è§‰å¾—åˆ‡åˆ°Githubä¸Šï¼Œæœ€ç»ˆè§‰å¾—é€šè¿‡Hexoå’ŒGithub Pageé‡æ–°æ­å»ºåšå®¢ï¼Œè¿™ç¯‡æ–‡ç« åªæ˜¯ä¸ºäº†è®°å½•æ­å»ºçš„è¿‡ç¨‹ï¼Œä»¥é˜²ä»¥åå¿˜è®°ï¼ˆè®°æ€§ä¸å¥½å•Šã€‚ã€‚ã€‚ï¼‰&lt;/p&gt;</summary>
    
    
    
    <category term="hexo" scheme="http://blog.jobshen.com/categories/hexo/"/>
    
    
    <category term="Hexo" scheme="http://blog.jobshen.com/tags/Hexo/"/>
    
    <category term="Github Page" scheme="http://blog.jobshen.com/tags/Github-Page/"/>
    
  </entry>
  
</feed>
